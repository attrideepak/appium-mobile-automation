"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createSim = createSim;
exports.getExistingSim = getExistingSim;
exports.runSimulatorReset = runSimulatorReset;
exports.installToSimulator = installToSimulator;
exports.shutdownSimulator = shutdownSimulator;
exports.shutdownOtherSimulators = shutdownOtherSimulators;

require("source-map-support/register");

var _appiumIosSimulator = require("appium-ios-simulator");

var _nodeSimctl = _interopRequireDefault(require("node-simctl"));

var _appiumWebdriveragent = require("appium-webdriveragent");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _desiredCaps = require("./desired-caps");

const APPIUM_SIM_PREFIX = 'appiumTest';

async function createSim(caps, platform = _desiredCaps.PLATFORM_NAME_IOS) {
  const devicesSetPath = caps.simulatorDevicesSetPath;
  const udid = await new _nodeSimctl.default({
    devicesSetPath
  }).createDevice(`${APPIUM_SIM_PREFIX}-${_appiumSupport.util.uuidV4().toUpperCase()}-${caps.deviceName}`, caps.deviceName, caps.platformVersion, {
    platform
  });
  return await (0, _appiumIosSimulator.getSimulator)(udid, {
    platform,
    checkExistence: false,
    devicesSetPath
  });
}

async function getExistingSim(opts = {}) {
  const {
    platformVersion,
    deviceName,
    simulatorDevicesSetPath: devicesSetPath
  } = opts;
  let appiumTestDevice;
  const simctl = new _nodeSimctl.default({
    devicesSetPath
  });

  for (const device of _lodash.default.values(await simctl.getDevices(platformVersion))) {
    if (device.name === deviceName) {
      return await (0, _appiumIosSimulator.getSimulator)(device.udid, {
        platform: device.platform,
        checkExistence: false,
        devicesSetPath
      });
    }

    if (device.name.startsWith(APPIUM_SIM_PREFIX) && device.name.endsWith(deviceName)) {
      appiumTestDevice = device;

      if (device.state === 'Booted') {
        break;
      }
    }
  }

  if (appiumTestDevice) {
    _logger.default.warn(`Unable to find device '${deviceName}'. ` + `Found '${appiumTestDevice.name}' (udid: '${appiumTestDevice.udid}') instead`);

    return await (0, _appiumIosSimulator.getSimulator)(appiumTestDevice.udid, {
      platform: appiumTestDevice.platform,
      checkExistence: false,
      devicesSetPath
    });
  }

  return null;
}

async function shutdownSimulator(device) {
  await (0, _appiumWebdriveragent.resetTestProcesses)(device.udid, true);
  await device.shutdown();
}

async function runSimulatorReset(device, opts) {
  if (opts.noReset && !opts.fullReset) {
    _logger.default.debug('Reset: noReset is on. Leaving simulator as is');

    return;
  }

  if (!device) {
    _logger.default.debug('Reset: no device available. Skipping');

    return;
  }

  if (opts.fullReset) {
    _logger.default.debug('Reset: fullReset is on. Cleaning simulator');

    await shutdownSimulator(device);
    let isKeychainsBackupSuccessful = false;

    if (opts.keychainsExcludePatterns || opts.keepKeyChains) {
      isKeychainsBackupSuccessful = await device.backupKeychains();
    }

    await device.clean();

    if (isKeychainsBackupSuccessful) {
      await device.restoreKeychains(opts.keychainsExcludePatterns || []);

      _logger.default.info(`Successfully restored keychains after full reset`);
    } else if (opts.keychainsExcludePatterns || opts.keepKeyChains) {
      _logger.default.warn('Cannot restore keychains after full reset, because ' + 'the backup operation did not succeed');
    }
  } else if (opts.bundleId) {
    if (await device.isRunning()) {
      if (opts.enforceSimulatorShutdown) {
        await shutdownSimulator(device);
      } else {
        try {
          await device.simctl.terminateApp(opts.bundleId);
        } catch (err) {
          _logger.default.warn(`Reset: failed to terminate Simulator application with id "${opts.bundleId}"`);
        }
      }
    }

    if (opts.app) {
      _logger.default.info('Not scrubbing third party app in anticipation of uninstall');

      return;
    }

    const isSafari = (opts.browserName || '').toLowerCase() === 'safari';

    try {
      if (isSafari) {
        await device.cleanSafari();
      } else {
        await device.scrubCustomApp('', opts.bundleId);
      }
    } catch (err) {
      _logger.default.warn(err.message);

      _logger.default.warn(`Reset: could not scrub ${isSafari ? 'Safari browser' : 'application with id "' + opts.bundleId + '"'}. Leaving as is.`);
    }
  }
}

async function installToSimulator(device, app, bundleId, opts = {}) {
  if (!app) {
    _logger.default.debug('No app path is given. Nothing to install.');

    return;
  }

  const {
    noReset = true,
    newSimulator = false
  } = opts;

  if (!newSimulator && bundleId && (await device.isAppInstalled(bundleId))) {
    if (noReset) {
      _logger.default.debug(`App '${bundleId}' is already installed. No need to reinstall.`);

      return;
    }

    _logger.default.debug(`Reset requested. Removing app with id '${bundleId}' from the device`);

    await device.removeApp(bundleId);
  }

  _logger.default.debug(`Installing '${app}' on Simulator with UUID '${device.udid}'...`);

  try {
    await device.installApp(app);
  } catch (e) {
    _logger.default.info(`Got an error on '${app}' install: ${e.message}`);

    _logger.default.info('Retrying application install');

    await device.installApp(app);
  }

  _logger.default.debug('The app has been installed successfully.');
}

async function shutdownOtherSimulators(currentDevice) {
  const simctl = new _nodeSimctl.default({
    devicesSetPath: currentDevice.devicesSetPath
  });

  const allDevices = _lodash.default.flatMap(_lodash.default.values(await simctl.getDevices()));

  const otherBootedDevices = allDevices.filter(device => device.udid !== currentDevice.udid && device.state === 'Booted');

  if (_lodash.default.isEmpty(otherBootedDevices)) {
    _logger.default.info('No other running simulators have been detected');

    return;
  }

  _logger.default.info(`Detected ${otherBootedDevices.length} other running ${_appiumSupport.util.pluralize('Simulator', otherBootedDevices.length)}.` + `Shutting them down...`);

  for (const {
    udid
  } of otherBootedDevices) {
    await (0, _appiumWebdriveragent.resetTestProcesses)(udid, true);
    simctl.udid = udid;
    await simctl.shutdownDevice();
  }
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3ItbWFuYWdlbWVudC5qcyJdLCJuYW1lcyI6WyJBUFBJVU1fU0lNX1BSRUZJWCIsImNyZWF0ZVNpbSIsImNhcHMiLCJwbGF0Zm9ybSIsIlBMQVRGT1JNX05BTUVfSU9TIiwiZGV2aWNlc1NldFBhdGgiLCJzaW11bGF0b3JEZXZpY2VzU2V0UGF0aCIsInVkaWQiLCJTaW1jdGwiLCJjcmVhdGVEZXZpY2UiLCJ1dGlsIiwidXVpZFY0IiwidG9VcHBlckNhc2UiLCJkZXZpY2VOYW1lIiwicGxhdGZvcm1WZXJzaW9uIiwiY2hlY2tFeGlzdGVuY2UiLCJnZXRFeGlzdGluZ1NpbSIsIm9wdHMiLCJhcHBpdW1UZXN0RGV2aWNlIiwic2ltY3RsIiwiZGV2aWNlIiwiXyIsInZhbHVlcyIsImdldERldmljZXMiLCJuYW1lIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwic3RhdGUiLCJsb2ciLCJ3YXJuIiwic2h1dGRvd25TaW11bGF0b3IiLCJzaHV0ZG93biIsInJ1blNpbXVsYXRvclJlc2V0Iiwibm9SZXNldCIsImZ1bGxSZXNldCIsImRlYnVnIiwiaXNLZXljaGFpbnNCYWNrdXBTdWNjZXNzZnVsIiwia2V5Y2hhaW5zRXhjbHVkZVBhdHRlcm5zIiwia2VlcEtleUNoYWlucyIsImJhY2t1cEtleWNoYWlucyIsImNsZWFuIiwicmVzdG9yZUtleWNoYWlucyIsImluZm8iLCJidW5kbGVJZCIsImlzUnVubmluZyIsImVuZm9yY2VTaW11bGF0b3JTaHV0ZG93biIsInRlcm1pbmF0ZUFwcCIsImVyciIsImFwcCIsImlzU2FmYXJpIiwiYnJvd3Nlck5hbWUiLCJ0b0xvd2VyQ2FzZSIsImNsZWFuU2FmYXJpIiwic2NydWJDdXN0b21BcHAiLCJtZXNzYWdlIiwiaW5zdGFsbFRvU2ltdWxhdG9yIiwibmV3U2ltdWxhdG9yIiwiaXNBcHBJbnN0YWxsZWQiLCJyZW1vdmVBcHAiLCJpbnN0YWxsQXBwIiwiZSIsInNodXRkb3duT3RoZXJTaW11bGF0b3JzIiwiY3VycmVudERldmljZSIsImFsbERldmljZXMiLCJmbGF0TWFwIiwib3RoZXJCb290ZWREZXZpY2VzIiwiZmlsdGVyIiwiaXNFbXB0eSIsImxlbmd0aCIsInBsdXJhbGl6ZSIsInNodXRkb3duRGV2aWNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsaUJBQWlCLEdBQUcsWUFBMUI7O0FBZUEsZUFBZUMsU0FBZixDQUEwQkMsSUFBMUIsRUFBZ0NDLFFBQVEsR0FBR0MsOEJBQTNDLEVBQThEO0FBQzVELFFBQU1DLGNBQWMsR0FBR0gsSUFBSSxDQUFDSSx1QkFBNUI7QUFDQSxRQUFNQyxJQUFJLEdBQUcsTUFBTSxJQUFJQyxtQkFBSixDQUFXO0FBQUNILElBQUFBO0FBQUQsR0FBWCxFQUE2QkksWUFBN0IsQ0FDaEIsR0FBRVQsaUJBQWtCLElBQUdVLG9CQUFLQyxNQUFMLEdBQWNDLFdBQWQsRUFBNEIsSUFBR1YsSUFBSSxDQUFDVyxVQUFXLEVBRHRELEVBRWpCWCxJQUFJLENBQUNXLFVBRlksRUFHakJYLElBQUksQ0FBQ1ksZUFIWSxFQUlqQjtBQUFDWCxJQUFBQTtBQUFELEdBSmlCLENBQW5CO0FBTUEsU0FBTyxNQUFNLHNDQUFhSSxJQUFiLEVBQW1CO0FBQzlCSixJQUFBQSxRQUQ4QjtBQUU5QlksSUFBQUEsY0FBYyxFQUFFLEtBRmM7QUFHOUJWLElBQUFBO0FBSDhCLEdBQW5CLENBQWI7QUFLRDs7QUFlRCxlQUFlVyxjQUFmLENBQStCQyxJQUFJLEdBQUcsRUFBdEMsRUFBMEM7QUFDeEMsUUFBTTtBQUNKSCxJQUFBQSxlQURJO0FBRUpELElBQUFBLFVBRkk7QUFHSlAsSUFBQUEsdUJBQXVCLEVBQUVEO0FBSHJCLE1BSUZZLElBSko7QUFNQSxNQUFJQyxnQkFBSjtBQUNBLFFBQU1DLE1BQU0sR0FBRyxJQUFJWCxtQkFBSixDQUFXO0FBQUNILElBQUFBO0FBQUQsR0FBWCxDQUFmOztBQUNBLE9BQUssTUFB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VUFBUCxFQUFmLENBQVYsQ0FBbkI7O0FBQ0EsUUFBTTBDLGtCQUFrQixHQUFHRixVQUFVLENBQUNHLE1BQVgsQ0FBbUI5QyxNQUFELElBQVlBLE1BQU0sQ0FBQ2IsSUFBUCxLQUFnQnVELGFBQWEsQ0FBQ3ZELElBQTlCLElBQXNDYSxNQUFNLENBQUNPLEtBQVAsS0FBaUIsUUFBckYsQ0FBM0I7O0FBQ0EsTUFBSU4sZ0JBQUU4QyxPQUFGLENBQVVGLGtCQUFWLENBQUosRUFBbUM7QUFDakNyQyxvQkFBSWMsSUFBSixDQUFTLGdEQUFUOztBQUNBO0FBQ0Q7O0FBQ0RkLGtCQUFJYyxJQUFKLENBQVUsWUFBV3VCLGtCQUFrQixDQUFDRyxNQUFPLGtCQUFpQjFELG9CQUFLMkQsU0FBTCxDQUFlLFdBQWYsRUFBNEJKLGtCQUFrQixDQUFDRyxNQUEvQyxDQUF1RCxHQUE5RyxHQUNOLHVCQURIOztBQUVBLE9BQUssTUFBTTtBQUFDN0QsSUFBQUE7QUFBRCxHQUFYLElBQXFCMEQsa0JBQXJCLEVBQXlDO0FBR3ZDLFVBQU0sOENBQW1CMUQsSUFBbkIsRUFBeUIsSUFBekIsQ0FBTjtBQUNBWSxJQUFBQSxNQUFNLENBQUNaLElBQVAsR0FBY0EsSUFBZDtBQUNBLFVBQU1ZLE1BQU0sQ0FBQ21ELGNBQVAsRUFBTjtBQUNEO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRTaW11bGF0b3IgfSBmcm9tICdhcHBpdW0taW9zLXNpbXVsYXRvcic7XG5pbXBvcnQgU2ltY3RsIGZyb20gJ25vZGUtc2ltY3RsJztcbmltcG9ydCB7IHJlc2V0VGVzdFByb2Nlc3NlcyB9IGZyb20gJ2FwcGl1bS13ZWJkcml2ZXJhZ2VudCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgUExBVEZPUk1fTkFNRV9JT1MgfSBmcm9tICcuL2Rlc2lyZWQtY2Fwcyc7XG5cblxuY29uc3QgQVBQSVVNX1NJTV9QUkVGSVggPSAnYXBwaXVtVGVzdCc7XG5cbi8qKlxuICogQ2FwYWJpbGl0eSBzZXQgYnkgYSB1c2VyXG4gKlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGRldmljZU5hbWUgLSBBIG5hbWUgZm9yIHRoZSBkZXZpY2VcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwbGF0Zm9ybVZlcnNpb24gLSBUaGUgdmVyc2lvbiBvZiBpT1MgdG8gdXNlXG4gKi9cbi8qKlxuICogQ3JlYXRlIGEgbmV3IHNpbXVsYXRvciB3aXRoIGBhcHBpdW1UZXN0LWAgcHJlZml4IGFuZCByZXR1cm4gdGhlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gU2ltQ3JlYXRpb25DYXBzIC0gQ2FwYWJpbGl0eSBzZXQgYnkgYSB1c2VyLiBUaGUgb3B0aW9ucyBhdmFpbGFibGUgYXJlOlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHBsYXRmb3JtIFtpT1NdIC0gUGxhdGZvcm0gbmFtZSBpbiBvcmRlciB0byBzcGVjaWZ5IHJ1bnRpbWUgc3VjaCBhcyAnaU9TJywgJ3R2T1MnLCAnd2F0Y2hPUydcbiAqIEByZXR1cm5zIHtvYmplY3R9IFNpbXVsYXRvciBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSB1ZGlkIHBhc3NlZCBpbi5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2ltIChjYXBzLCBwbGF0Zm9ybSA9IFBMQVRGT1JNX05BTUVfSU9TKSB7XG4gIGNvbnN0IGRldmljZXNTZXRQYXRoID0gY2Fwcy5zaW11bGF0b3JEZXZpY2VzU2V0UGF0aDtcbiAgY29uc3QgdWRpZCA9IGF3YWl0IG5ldyBTaW1jdGwoe2RldmljZXNTZXRQYXRofSkuY3JlYXRlRGV2aWNlKFxuICAgIGAke0FQUElVTV9TSU1fUFJFRklYfS0ke3V0aWwudXVpZFY0KCkudG9VcHBlckNhc2UoKX0tJHtjYXBzLmRldmljZU5hbWV9YCxcbiAgICBjYXBzLmRldmljZU5hbWUsXG4gICAgY2Fwcy5wbGF0Zm9ybVZlcnNpb24sXG4gICAge3BsYXRmb3JtfSxcbiAgKTtcbiAgcmV0dXJuIGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkLCB7XG4gICAgcGxhdGZvcm0sXG4gICAgY2hlY2tFeGlzdGVuY2U6IGZhbHNlLFxuICAgIGRldmljZXNTZXRQYXRoLFxuICB9KTtcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTaW11bGF0b3JMb29rdXBPcHRpb25zXG4gKiBAcHJvcGVydHkgeyFzdHJpbmd9IGRldmljZU5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZGV2aWNlIHRvIGxvb2t1cFxuICogQHByb3BlcnR5IHshc3RyaW5nfSBwbGF0Zm9ybVZlcnNpb24gLSBUaGUgcGxhdGZvcm0gdmVyc2lvbiBzdHJpbmdcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc2ltdWxhdG9yRGV2aWNlc1NldFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBzaW11bGF0b3IgZGV2aWNlcyBzZXRcbiAqL1xuXG4vKipcbiAqIEdldCBhIHNpbXVsYXRvciB3aGljaCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gKlxuICogQHBhcmFtIHs/U2ltdWxhdG9yTG9va3VwT3B0aW9uc30gb3B0c1xuICogQHJldHVybnMgez9TaW11bGF0b3J9IFRoZSBtYXRjaGVkIFNpbXVsYXRvciBpbnN0YW5jZSBvciBgbnVsbGAgaWYgbm8gbWF0Y2hpbmcgIGRldmljZSBpcyBmb3VuZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RXhpc3RpbmdTaW0gKG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgcGxhdGZvcm1WZXJzaW9uLFxuICAgIGRldmljZU5hbWUsXG4gICAgc2ltdWxhdG9yRGV2aWNlc1NldFBhdGg6IGRldmljZXNTZXRQYXRoLFxuICB9ID0gb3B0cztcblxuICBsZXQgYXBwaXVtVGVzdERldmljZTtcbiAgY29uc3Qgc2ltY3RsID0gbmV3IFNpbWN0bCh7ZGV2aWNlc1NldFBhdGh9KTtcbiAgZm9yIChjb25zdCBkZXZpY2Ugb2YgXy52YWx1ZXMoYXdhaXQgc2ltY3RsLmdldERldmljZXMocGxhdGZvcm1WZXJzaW9uKSkpIHtcbiAgICBpZiAoZGV2aWNlLm5hbWUgPT09IGRldmljZU5hbWUpIHtcbiAgICAgIHJldHVybiBhd2FpdCBnZXRTaW11bGF0b3IoZGV2aWNlLnVkaWQsIHtcbiAgICAgICAgcGxhdGZvcm06IGRldmljZS5wbGF0Zm9ybSxcbiAgICAgICAgY2hlY2tFeGlzdGVuY2U6IGZhbHNlLFxuICAgICAgICBkZXZpY2VzU2V0UGF0aCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChkZXZpY2UubmFtZS5zdGFydHNXaXRoKEFQUElVTV9TSU1fUFJFRklYKSAmJiBkZXZpY2UubmFtZS5lbmRzV2l0aChkZXZpY2VOYW1lKSkge1xuICAgICAgYXBwaXVtVGVzdERldmljZSA9IGRldmljZTtcbiAgICAgIC8vIGNob29zZSB0aGUgZmlyc3QgYm9vdGVkIHNpbXVsYXRvclxuICAgICAgaWYgKGRldmljZS5zdGF0ZSA9PT0gJ0Jvb3RlZCcpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKGFwcGl1bVRlc3REZXZpY2UpIHtcbiAgICBsb2cud2FybihgVW5hYmxlIHRvIGZpbmQgZGV2aWNlICcke2RldmljZU5hbWV9Jy4gYCArXG4gICAgICBgRm91bmQgJyR7YXBwaXVtVGVzdERldmljZS5uYW1lfScgKHVkaWQ6ICcke2FwcGl1bVRlc3REZXZpY2UudWRpZH0nKSBpbnN0ZWFkYCk7XG4gICAgcmV0dXJuIGF3YWl0IGdldFNpbXVsYXRvcihhcHBpdW1UZXN0RGV2aWNlLnVkaWQsIHtcbiAgICAgIHBsYXRmb3JtOiBhcHBpdW1UZXN0RGV2aWNlLnBsYXRmb3JtLFxuICAgICAgY2hlY2tFeGlzdGVuY2U6IGZhbHNlLFxuICAgICAgZGV2aWNlc1NldFBhdGgsXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNodXRkb3duU2ltdWxhdG9yIChkZXZpY2UpIHtcbiAgLy8gc3RvcCBYQ1Rlc3QgcHJvY2Vzc2VzIGlmIHJ1bm5pbmcgdG8gYXZvaWQgdW5leHBlY3RlZCBzaWRlIGVmZmVjdHNcbiAgYXdhaXQgcmVzZXRUZXN0UHJvY2Vzc2VzKGRldmljZS51ZGlkLCB0cnVlKTtcbiAgYXdhaXQgZGV2aWNlLnNodXRkb3duKCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJ1blNpbXVsYXRvclJlc2V0IChkZXZpY2UsIG9wdHMpIHtcbiAgaWYgKG9wdHMubm9SZXNldCAmJiAhb3B0cy5mdWxsUmVzZXQpIHtcbiAgICAvLyBub1Jlc2V0ID09PSB0cnVlICYmIGZ1bGxSZXNldCA9PT0gZmFsc2VcbiAgICBsb2cuZGVidWcoJ1Jlc2V0OiBub1Jlc2V0IGlzIG9uLiBMZWF2aW5nIHNpbXVsYXRvciBhcyBpcycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghZGV2aWNlKSB7XG4gICAgbG9nLmRlYnVnKCdSZXNldDogbm8gZGV2aWNlIGF2YWlsYWJsZS4gU2tpcHBpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAob3B0cy5mdWxsUmVzZXQpIHtcbiAgICBsb2cuZGVidWcoJ1Jlc2V0OiBmdWxsUmVzZXQgaXMgb24uIENsZWFuaW5nIHNpbXVsYXRvcicpO1xuICAgIGF3YWl0IHNodXRkb3duU2ltdWxhdG9yKGRldmljZSk7XG4gICAgbGV0IGlzS2V5Y2hhaW5zQmFja3VwU3VjY2Vzc2Z1bCA9IGZhbHNlO1xuICAgIGlmIChvcHRzLmtleWNoYWluc0V4Y2x1ZGVQYXR0ZXJucyB8fCBvcHRzLmtlZXBLZXlDaGFpbnMpIHtcbiAgICAgIGlzS2V5Y2hhaW5zQmFja3VwU3VjY2Vzc2Z1bCA9IGF3YWl0IGRldmljZS5iYWNrdXBLZXljaGFpbnMoKTtcbiAgICB9XG4gICAgYXdhaXQgZGV2aWNlLmNsZWFuKCk7XG4gICAgaWYgKGlzS2V5Y2hhaW5zQmFja3VwU3VjY2Vzc2Z1bCkge1xuICAgICAgYXdhaXQgZGV2aWNlLnJlc3RvcmVLZXljaGFpbnMob3B0cy5rZXljaGFpbnNFeGNsdWRlUGF0dGVybnMgfHwgW10pO1xuICAgICAgbG9nLmluZm8oYFN1Y2Nlc3NmdWxseSByZXN0b3JlZCBrZXljaGFpbnMgYWZ0ZXIgZnVsbCByZXNldGApO1xuICAgIH0gZWxzZSBpZiAob3B0cy5rZXljaGFpbnNFeGNsdWRlUGF0dGVybnMgfHwgb3B0cy5rZWVwS2V5Q2hhaW5zKSB7XG4gICAgICBsb2cud2FybignQ2Fubm90IHJlc3RvcmUga2V5Y2hhaW5zIGFmdGVyIGZ1bGwgcmVzZXQsIGJlY2F1c2UgJyArXG4gICAgICAgICAgICAgICAndGhlIGJhY2t1cCBvcGVyYXRpb24gZGlkIG5vdCBzdWNjZWVkJyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKG9wdHMuYnVuZGxlSWQpIHtcbiAgICAvLyBmYXN0UmVzZXQgb3Igbm9SZXNldFxuXG4gICAgLy8gVGVybWluYXRlIHRoZSBhcHAgdW5kZXIgdGVzdCBpZiBpdCBpcyBzdGlsbCBydW5uaW5nIG9uIFNpbXVsYXRvclxuICAgIC8vIFRlcm1pbmF0aW9uIGlzIG5vdCBuZWVkZWQgaWYgU2ltdWxhdG9yIGlzIG5vdCBydW5uaW5nXG4gICAgaWYgKGF3YWl0IGRldmljZS5pc1J1bm5pbmcoKSkge1xuICAgICAgaWYgKG9wdHMuZW5mb3JjZVNpbXVsYXRvclNodXRkb3duKSB7XG4gICAgICAgIGF3YWl0IHNodXRkb3duU2ltdWxhdG9yKGRldmljZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGRldmljZS5zaW1jdGwudGVybWluYXRlQXBwKG9wdHMuYnVuZGxlSWQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBsb2cud2FybihgUmVzZXQ6IGZhaWxlZCB0byB0ZXJtaW5hdGUgU2ltdWxhdG9yIGFwcGxpY2F0aW9uIHdpdGggaWQgXCIke29wdHMuYnVuZGxlSWR9XCJgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3B0cy5hcHApIHtcbiAgICAgIGxvZy5pbmZvKCdOb3Qgc2NydWJiaW5nIHRoaXJkIHBhcnR5IGFwcCBpbiBhbnRpY2lwYXRpb24gb2YgdW5pbnN0YWxsJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGlzU2FmYXJpID0gKG9wdHMuYnJvd3Nlck5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09ICdzYWZhcmknO1xuICAgIHRyeSB7XG4gICAgICBpZiAoaXNTYWZhcmkpIHtcbiAgICAgICAgYXdhaXQgZGV2aWNlLmNsZWFuU2FmYXJpKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpT1MgOCsgZG9lcyBub3QgbmVlZCBiYXNlbmFtZVxuICAgICAgICBhd2FpdCBkZXZpY2Uuc2NydWJDdXN0b21BcHAoJycsIG9wdHMuYnVuZGxlSWQpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oZXJyLm1lc3NhZ2UpO1xuICAgICAgbG9nLndhcm4oYFJlc2V0OiBjb3VsZCBub3Qgc2NydWIgJHtpc1NhZmFyaSA/ICdTYWZhcmkgYnJvd3NlcicgOiAnYXBwbGljYXRpb24gd2l0aCBpZCBcIicgKyBvcHRzLmJ1bmRsZUlkICsgJ1wiJ30uIExlYXZpbmcgYXMgaXMuYCk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE9wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSBub1Jlc2V0IFtmYWxzZV0gV2hldGhlciB0byBkaXNhYmxlIHJlc2V0XG4gKiBAcHJvcGVydHkgez9ib29sZWFufSBuZXdTaW11bGF0b3IgW2ZhbHNlXSBXaGV0aGVyIHRoZSBzaW11bGF0b3IgaXMgYnJhbmQgbmV3XG4gKi9cblxuLyoqXG4gKiBAcGFyYW0ge29iamVjdH0gZGV2aWNlIFRoZSBzaW11bGF0b3IgZGV2aWNlIG9iamVjdFxuICogQHBhcmFtIHs/c3RyaW5nfSBhcHAgVGhlIGFwcCB0byB0aGUgcGF0aFxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIFRoZSBidW5kbGUgaWQgdG8gZW5zdXJlIGl0IGlzIGFscmVhZHkgaW5zdGFsbGVkIGFuZCB1bmluc3RhbGwgaXRcbiAqIEBwYXJhbSB7P0luc3RhbGxPcHRpb25zfSBvcHRzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGluc3RhbGxUb1NpbXVsYXRvciAoZGV2aWNlLCBhcHAsIGJ1bmRsZUlkLCBvcHRzID0ge30pIHtcbiAgaWYgKCFhcHApIHtcbiAgICBsb2cuZGVidWcoJ05vIGFwcCBwYXRoIGlzIGdpdmVuLiBOb3RoaW5nIHRvIGluc3RhbGwuJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qge1xuICAgIG5vUmVzZXQgPSB0cnVlLFxuICAgIG5ld1NpbXVsYXRvciA9IGZhbHNlLFxuICB9ID0gb3B0cztcblxuICBpZiAoIW5ld1NpbXVsYXRvciAmJiBidW5kbGVJZCAmJiBhd2FpdCBkZXZpY2UuaXNBcHBJbnN0YWxsZWQoYnVuZGxlSWQpKSB7XG4gICAgaWYgKG5vUmVzZXQpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQXBwICcke2J1bmRsZUlkfScgaXMgYWxyZWFkeSBpbnN0YWxsZWQuIE5vIG5lZWQgdG8gcmVpbnN0YWxsLmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYFJlc2V0IHJlcXVlc3RlZC4gUmVtb3ZpbmcgYXBwIHdpdGggaWQgJyR7YnVuZGxlSWR9JyBmcm9tIHRoZSBkZXZpY2VgKTtcbiAgICBhd2FpdCBkZXZpY2UucmVtb3ZlQXBwKGJ1bmRsZUlkKTtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgSW5zdGFsbGluZyAnJHthcHB9JyBvbiBTaW11bGF0b3Igd2l0aCBVVUlEICcke2RldmljZS51ZGlkfScuLi5gKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBkZXZpY2UuaW5zdGFsbEFwcChhcHApO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gaXQgc29tZXRpbWVzIGZhaWxzIG9uIFhjb2RlIDEwIGJlY2F1c2Ugb2YgYSByYWNlIGNvbmRpdGlvblxuICAgIGxvZy5pbmZvKGBHb3QgYW4gZXJyb3Igb24gJyR7YXBwfScgaW5zdGFsbDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgbG9nLmluZm8oJ1JldHJ5aW5nIGFwcGxpY2F0aW9uIGluc3RhbGwnKTtcbiAgICBhd2FpdCBkZXZpY2UuaW5zdGFsbEFwcChhcHApO1xuICB9XG4gIGxvZy5kZWJ1ZygnVGhlIGFwcCBoYXMgYmVlbiBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5LicpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzaHV0ZG93bk90aGVyU2ltdWxhdG9ycyAoY3VycmVudERldmljZSkge1xuICBjb25zdCBzaW1jdGwgPSBuZXcgU2ltY3RsKHtcbiAgICBkZXZpY2VzU2V0UGF0aDogY3VycmVudERldmljZS5kZXZpY2VzU2V0UGF0aFxuICB9KTtcbiAgY29uc3QgYWxsRGV2aWNlcyA9IF8uZmxhdE1hcChfLnZhbHVlcyhhd2FpdCBzaW1jdGwuZ2V0RGV2aWNlcygpKSk7XG4gIGNvbnN0IG90aGVyQm9vdGVkRGV2aWNlcyA9IGFsbERldmljZXMuZmlsdGVyKChkZXZpY2UpID0+IGRldmljZS51ZGlkICE9PSBjdXJyZW50RGV2aWNlLnVkaWQgJiYgZGV2aWNlLnN0YXRlID09PSAnQm9vdGVkJyk7XG4gIGlmIChfLmlzRW1wdHkob3RoZXJCb290ZWREZXZpY2VzKSkge1xuICAgIGxvZy5pbmZvKCdObyBvdGhlciBydW5uaW5nIHNpbXVsYXRvcnMgaGF2ZSBiZWVuIGRldGVjdGVkJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxvZy5pbmZvKGBEZXRlY3RlZCAke290aGVyQm9vdGVkRGV2aWNlcy5sZW5ndGh9IG90aGVyIHJ1bm5pbmcgJHt1dGlsLnBsdXJhbGl6ZSgnU2ltdWxhdG9yJywgb3RoZXJCb290ZWREZXZpY2VzLmxlbmd0aCl9LmAgK1xuICAgIGBTaHV0dGluZyB0aGVtIGRvd24uLi5gKTtcbiAgZm9yIChjb25zdCB7dWRpZH0gb2Ygb3RoZXJCb290ZWREZXZpY2VzKSB7XG4gICAgLy8gSXQgaXMgbmVjZXNzYXJ5IHRvIHN0b3AgdGhlIGNvcnJlc3BvbmRpbmcgeGNvZGVidWlsZCBwcm9jZXNzIGJlZm9yZSBraWxsaW5nXG4gICAgLy8gdGhlIHNpbXVsYXRvciwgb3RoZXJ3aXNlIGl0IHdpbGwgYmUgYXV0b21hdGljYWxseSByZXN0YXJ0ZWRcbiAgICBhd2FpdCByZXNldFRlc3RQcm9jZXNzZXModWRpZCwgdHJ1ZSk7XG4gICAgc2ltY3RsLnVkaWQgPSB1ZGlkO1xuICAgIGF3YWl0IHNpbWN0bC5zaHV0ZG93bkRldmljZSgpO1xuICB9XG59XG5cbmV4cG9ydCB7IGNyZWF0ZVNpbSwgZ2V0RXhpc3RpbmdTaW0sIHJ1blNpbXVsYXRvclJlc2V0LCBpbnN0YWxsVG9TaW11bGF0b3IsXG4gIHNodXRkb3duU2ltdWxhdG9yLCBzaHV0ZG93bk90aGVyU2ltdWxhdG9ycyB9O1xuIl0sImZpbGUiOiJsaWIvc2ltdWxhdG9yLW1hbmFnZW1lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
