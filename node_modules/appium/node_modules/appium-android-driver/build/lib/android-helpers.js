"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.prepareAvdArgs = prepareAvdArgs;
exports.ensureNetworkSpeed = ensureNetworkSpeed;
exports.default = exports.SETTINGS_HELPER_PKG_ID = exports.helpers = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _ioAppium = require("io.appium.settings");

var _bootstrap = _interopRequireDefault(require("./bootstrap"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumAdb = _interopRequireDefault(require("appium-adb"));

var _unlockHelpers = _interopRequireWildcard(require("./unlock-helpers"));

var _os = require("os");

var _semver = _interopRequireDefault(require("semver"));

const PACKAGE_INSTALL_TIMEOUT = 90000;
const CHROME_BROWSER_PACKAGE_ACTIVITY = {
  chrome: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  chromium: {
    pkg: 'org.chromium.chrome.shell',
    activity: '.ChromeShellActivity'
  },
  chromebeta: {
    pkg: 'com.chrome.beta',
    activity: 'com.google.android.apps.chrome.Main'
  },
  browser: {
    pkg: 'com.android.browser',
    activity: 'com.android.browser.BrowserActivity'
  },
  'chromium-browser': {
    pkg: 'org.chromium.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  'chromium-webview': {
    pkg: 'org.chromium.webview_shell',
    activity: 'org.chromium.webview_shell.WebViewBrowserActivity'
  },
  default: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  }
};
const SETTINGS_HELPER_PKG_ID = 'io.appium.settings';
exports.SETTINGS_HELPER_PKG_ID = SETTINGS_HELPER_PKG_ID;
const SETTINGS_HELPER_UNLOCK_ACTIVITY = '.Unlock';
const EMULATOR_PATTERN = /\bemulator\b/i;

function ensureNetworkSpeed(adb, networkSpeed) {
  if (_lodash.default.values(adb.NETWORK_SPEED).includes(networkSpeed)) {
    return networkSpeed;
  }

  _logger.default.warn(`Wrong network speed param '${networkSpeed}', using default: ${adb.NETWORK_SPEED.FULL}. ` + `Supported values: ${_lodash.default.values(adb.NETWORK_SPEED)}`);

  return adb.NETWORK_SPEED.FULL;
}

function prepareAvdArgs(adb, opts) {
  const {
    networkSpeed,
    isHeadless,
    avdArgs
  } = opts;
  const result = [];

  if (avdArgs) {
    if (_lodash.default.isArray(avdArgs)) {
      result.push(...avdArgs);
    } else {
      result.push(..._appiumSupport.util.shellParse(`${avdArgs}`));
    }
  }

  if (networkSpeed) {
    result.push('-netspeed', ensureNetworkSpeed(adb, networkSpeed));
  }

  if (isHeadless) {
    result.push('-no-window');
  }

  return result;
}

const helpers = {};
exports.helpers = helpers;

helpers.createBaseADB = async function createBaseADB(opts = {}) {
  const {
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion,
    allowOfflineDevices,
    allowDelayAdb
  } = opts;
  return await _appiumAdb.default.createADB({
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion,
    allowOfflineDevices,
    allowDelayAdb
  });
};

helpers.prepareEmulator = async function prepareEmulator(adb, opts) {
  const {
    avd,
    avdEnv: env,
    language,
    locale: country,
    avdLaunchTimeout: launchTimeout,
    avdReadyTimeout: readyTimeout
  } = opts;

  if (!avd) {
    throw new Error('Cannot launch AVD without AVD name');
  }

  const avdName = avd.replace('@', '');
  const runningAVD = await adb.getRunningAVD(avdName);
  const args = prepareAvdArgs(adb, opts);

  if (runningAVD) {
    if (args.includes('-wipe-data')) {
      _logger.default.debug(`Killing '${avdName}' because it needs to be wiped at start.`);

      await adb.killEmulator(avdName);
    } else {
      _logger.default.debug('Not launching AVD because it is already running.');

      return;
    }
  }

  await adb.launchAVD(avd, {
    args,
    env,
    language,
    country,
    launchTimeout,
    readyTimeout
  });
};

helpers.ensureDeviceLocale = async function ensureDeviceLocale(adb, language, country, script = null) {
  if (!_lodash.default.isString(language) && !_lodash.default.isString(country)) {
    _logger.default.warn(`setDeviceLanguageCountry requires language or country.`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  await adb.setDeviceLanguageCountry(language, country, script);

  if (!(await adb.ensureCurrentLocale(language, country, script))) {
    const message = script ? `language: ${language}, country: ${country} and script: ${script}` : `language: ${language} and country: ${country}`;
    throw new Error(`Failed to set ${message}`);
  }
};

helpers.getDeviceInfoFromCaps = async function getDeviceInfoFromCaps(opts = {}) {
  const adb = await helpers.createBaseADB(opts);
  let udid = opts.udid;
  let emPort = null;

  if (opts.avd) {
    await helpers.prepareEmulator(adb, opts);
    udid = adb.curDeviceId;
    emPort = adb.emulatorPort;
  } else {
    _logger.default.info('Retrieving device list');

    let devices = await adb.getDevicesWithRetry();

    if (udid) {
      if (!_lodash.default.includes(_lodash.default.map(devices, 'udid'), udid)) {
        _logger.default.errorAndThrow(`Device ${udid} was not in the list of connected devices`);
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else if (opts.platformVersion) {
      opts.platformVersion = `${opts.platformVersion}`.trim();
      const platformVersion = _semver.default.coerce(opts.platformVersion) || opts.platformVersion;

      _logger.default.info(`Looking for a device with Android '${platformVersion}'`);

      const availDevices = [];
      let partialMatchCandidate = null;

      for (const device of devices) {
        await adb.setDeviceId(device.udid);
        const rawDeviceOS = await adb.getPlatformVersion();
        availDevices.push(`${device.udid} (${rawDeviceOS})`);
        const deviceOS = _semver.default.coerce(rawDeviceOS) || rawDeviceOS;

        if (!deviceOS) {
          continue;
        }

        const bothVersionsCanBeCoerced = _semver.default.valid(deviceOS) && _semver.default.valid(platformVersion);

        const bothVersionsAreStrings = _lodash.default.isString(deviceOS) && _lodash.default.isString(platformVersion);

        if (bothVersionsCanBeCoerced && deviceOS.version === platformVersion.version || bothVersionsAreStrings && _lodash.default.toLower(deviceOS) === _lodash.default.toLower(platformVersion)) {
          udid = device.udid;
          break;
        } else if (!bothVersionsCanBeCoerced) {
          continue;
        }

        if ((!_lodash.default.includes(opts.platformVersion, '.') && platformVersion.major === deviceOS.major || platformVersion.major === deviceOS.major && platformVersion.minor === deviceOS.minor) && (partialMatchCandidate && _semver.default.gt(deviceOS, _lodash.default.values(partialMatchCandidate)[0]) || !partialMatchCandidate)) {
          partialMatchCandidate = {
            [device.udid]: deviceOS
          };
        }
      }

      if (!udid && partialMatchCandidate) {
        udid = _lodash.default.keys(partialMatchCandidate)[0];
        await adb.setDeviceId(udid);
      }

      if (!udid) {
        _logger.default.errorAndThrow(`Unable to find an active device or emulator ` + `with OS ${opts.platformVersion}. The following are available: ` + availDevices.join(', '));
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else {
      udid = devices[0].udid;
      emPort = adb.getPortFromEmulatorString(udid);
    }
  }

  _logger.default.info(`Using device: ${udid}`);

  return {
    udid,
    emPort
  };
};

helpers.createADB = async function createADB(opts = {}) {
  const {
    udid,
    emPort
  } = opts;
  const adb = await helpers.createBaseADB(opts);
  adb.setDeviceId(udid);

  if (emPort) {
    adb.setEmulatorPort(emPort);
  }

  return adb;
};

helpers.validatePackageActivityNames = function validatePackageActivityNames(opts) {
  for (const key of ['appPackage', 'appActivity', 'appWaitPackage', 'appWaitActivity']) {
    const name = opts[key];

    if (!name) {
      continue;
    }

    const match = /([^\w.*,])+/.exec(name);

    if (!match) {
      continue;
    }

    _logger.default.warn(`Capability '${key}' is expected to only include latin letters, digits, underscore, dot, comma and asterisk characters.`);

    _logger.default.warn(`Current value '${name}' has non-matching character at index ${match.index}: '${name.substring(0, match.index + 1)}'`);
  }
};

helpers.getLaunchInfo = async function getLaunchInfo(adb, opts) {
  let {
    app,
    appPackage,
    appActivity,
    appWaitPackage,
    appWaitActivity
  } = opts;

  if (!app) {
    _logger.default.warn('No app sent in, not parsing package/activity');

    return;
  }

  this.validatePackageActivityNames(opts);

  if (appPackage && appActivity) {
    return;
  }

  _logger.default.debug('Parsing package and activity from app manifest');

  let {
    apkPackage,
    apkActivity
  } = await adb.packageAndLaunchActivityFromManifest(app);

  if (apkPackage && !appPackage) {
    appPackage = apkPackage;
  }

  if (!appWaitPackage) {
    appWaitPackage = appPackage;
  }

  if (apkActivity && !appActivity) {
    appActivity = apkActivity;
  }

  if (!appWaitActivity) {
    appWaitActivity = appActivity;
  }

  _logger.default.debug(`Parsed package and activity are: ${apkPackage}/${apkActivity}`);

  return {
    appPackage,
    appWaitPackage,
    appActivity,
    appWaitActivity
  };
};

helpers.resetApp = async function resetApp(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;

  if (!appPackage) {
    throw new Error("'appPackage' option is required");
  }

  const isInstalled = await adb.isAppInstalled(appPackage);

  if (isInstalled) {
    try {
      await adb.forceStop(appPackage);
    } catch (ign) {}

    if (!fullReset && fastReset) {
      const output = await adb.clear(appPackage);

      if (_lodash.default.isString(output) && output.toLowerCase().includes('failed')) {
        throw new Error(`Cannot clear the application data of '${appPackage}'. Original error: ${output}`);
      }

      if (autoGrantPermissions) {
        try {
          await adb.grantAllPermissions(appPackage);
        } catch (error) {
          _logger.default.error(`Unable to grant permissions requested. Original error: ${error.message}`);
        }
      }

      _logger.default.debug(`Performed fast reset on the installed '${appPackage}' application (stop and clear)`);

      return;
    }
  }

  if (!app) {
    throw new Error("'app' option is required for reinstall");
  }

  _logger.default.debug(`Running full reset on '${appPackage}' (reinstall)`);

  if (isInstalled) {
    await adb.uninstallApk(appPackage);
  }

  await adb.install(app, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages
  });
};

helpers.installApk = async function installApk(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages,
    enforceAppInstall
  } = opts;

  if (!app || !appPackage) {
    throw new Error("'app' and 'appPackage' options are required");
  }

  if (fullReset) {
    await this.resetApp(adb, opts);
    return;
  }

  const {
    appState,
    wasUninstalled
  } = await adb.installOrUpgrade(app, appPackage, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages,
    enforceCurrentBuild: enforceAppInstall
  });
  const isInstalledOverExistingApp = !wasUninstalled && appState !== adb.APP_INSTALL_STATE.NOT_INSTALLED;

  if (fastReset && isInstalledOverExistingApp) {
    _logger.default.info(`Performing fast reset on '${appPackage}'`);

    await this.resetApp(adb, opts);
  }
};

helpers.installOtherApks = async function installOtherApks(otherApps, adb, opts) {
  let {
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;
  await _bluebird.default.all(otherApps.map(otherApp => {
    _logger.default.debug(`Installing app: ${otherApp}`);

    return adb.installOrUpgrade(otherApp, null, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });
  }));
};

helpers.uninstallOtherPackages = async function uninstallOtherPackages(adb, appPackages, filterPackages = []) {
  if (appPackages.includes('*')) {
    _logger.default.debug('Uninstall third party packages');

    appPackages = await this.getThirdPartyPackages(adb, filterPackages);
  }

  _logger.default.debug(`Uninstalling packages: ${appPackages}`);

  await _bluebird.default.all(appPackages.map(appPackage => adb.uninstallApk(appPackage)));
};

helpers.getThirdPartyPackages = async function getThirdPartyPackages(adb, filterPackages = []) {
  try {
    const packagesString = await adb.shell(['pm', 'list', 'packages', '-3']);
    const appPackagesArray = packagesString.trim().replace(/package:/g, '').split(_os.EOL);

    _logger.default.debug(`'${appPackagesArray}' filtered with '${filterPackages}'`);

    return _lodash.default.difference(appPackagesArray, filterPackages);
  } catch (err) {
    _logger.default.warn(`Unable to get packages with 'adb shell pm list packages -3': ${err.message}`);

    return [];
  }
};

helpers.initUnicodeKeyboard = async function initUnicodeKeyboard(adb) {
  _logger.default.debug('Enabling Unicode keyboard support');

  let defaultIME = await adb.defaultIME();

  _logger.default.debug(`Unsetting previous IME ${defaultIME}`);

  const appiumIME = `${SETTINGS_HELPER_PKG_ID}/.UnicodeIME`;

  _logger.default.debug(`Setting IME to '${appiumIME}'`);

  await adb.enableIME(appiumIME);
  await adb.setIME(appiumIME);
  return defaultIME;
};

helpers.setMockLocationApp = async function setMockLocationApp(adb, app) {
  try {
    if ((await adb.getApiLevel()) < 23) {
      await adb.shell(['settings', 'put', 'secure', 'mock_location', '1']);
    } else {
      await adb.shell(['appops', 'set', app, 'android:mock_location', 'allow']);
    }
  } catch (err) {
    _logger.default.warn(`Unable to set mock location for app '${app}': ${err.message}`);
  }
};

helpers.installHelperApp = async function installHelperApp(adb, apkPath, packageId) {
  await (0, _asyncbox.retry)(2, async function retryInstallHelperApp() {
    await adb.installOrUpgrade(apkPath, packageId, {
      grantPermissions: true
    });
  });
};

helpers.pushSettingsApp = async function pushSettingsApp(adb, throwError = false) {
  _logger.default.debug('Pushing settings apk to device...');

  try {
    await helpers.installHelperApp(adb, _ioAppium.path, SETTINGS_HELPER_PKG_ID, throwError);
  } catch (err) {
    if (throwError) {
      throw err;
    }

    _logger.default.warn(`Ignored error while installing '${_ioAppium.path}': ` + `'${err.message}'. Features that rely on this helper ` + 'require the apk such as toggle WiFi and getting location ' + 'will raise an error if you try to use them.');
  }

  if (await adb.processExists(SETTINGS_HELPER_PKG_ID)) {
    _logger.default.debug(`${SETTINGS_HELPER_PKG_ID} is already running. ` + `There is no need to reset its permissions.`);

    return;
  }

  if ((await adb.getApiLevel()) <= 23) {
    const perms = ['SET_ANIMATION_SCALE', 'CHANGE_CONFIGURATION', 'ACCESS_FINE_LOCATION'];

    _logger.default.info(`Granting permissions ${perms} to '${SETTINGS_HELPER_PKG_ID}'`);

    await adb.grantPermissions(SETTINGS_HELPER_PKG_ID, perms.map(x => `android.permission.${x}`));
  }

  try {
    await adb.requireRunningSettingsApp();
  } catch (err) {
    _logger.default.debug(err);

    if (throwError) {
      throw err;
    }
  }
};

helpers.pushStrings = async function pushStrings(language, adb, opts) {
  const remoteDir = '/data/local/tmp';
  const stringsJson = 'strings.json';

  const remoteFile = _path.default.posix.resolve(remoteDir, stringsJson);

  await adb.rimraf(remoteFile);
  let app;

  try {
    app = opts.app || (await adb.pullApk(opts.appPackage, opts.tmpDir));
  } catch (err) {
    _logger.default.info(`Failed to pull an apk from '${opts.appPackage}' to '${opts.tmpDir}'. Original error: ${err.message}`);
  }

  if (_lodash.default.isEmpty(opts.appPackage) || !(await _appiumSupport.fs.exists(app))) {
    _logger.default.debug(`No app or package specified. Returning empty strings`);

    return {};
  }

  const stringsTmpDir = _path.default.resolve(opts.tmpDir, opts.appPackage);

  try {
    _logger.default.debug('Extracting strings from apk', app, language, stringsTmpDir);

    const {
      apkStrings,
      localPath
    } = await adb.extractStringsFromApk(app, language, stringsTmpDir);
    await adb.push(localPath, remoteDir);
    return apkStrings;
  } catch (err) {
    _logger.default.warn(`Could not get strings, continuing anyway. Original error: ${err.message}`);

    await adb.shell('echo', [`'{}' > ${remoteFile}`]);
  } finally {
    await _appiumSupport.fs.rimraf(stringsTmpDir);
  }

  return {};
};

helpers.unlockWithUIAutomation = async function unlockWithUIAutomation(driver, adb, unlockCapabilities) {
  let unlockType = unlockCapabilities.unlockType;

  if (!_unlockHelpers.default.isValidUnlockType(unlockType)) {
    throw new Error(`Invalid unlock type ${unlockType}`);
  }

  let unlockKey = unlockCapabilities.unlockKey;

  if (!_unlockHelpers.default.isValidKey(unlockType, unlockKey)) {
    throw new Error(`Missing unlockKey ${unlockKey} capability for unlockType ${unlockType}`);
  }

  const unlockMethod = {
    [_unlockHelpers.PIN_UNLOCK]: _unlockHelpers.default.pinUnlock,
    [_unlockHelpers.PASSWORD_UNLOCK]: _unlockHelpers.default.passwordUnlock,
    [_unlockHelpers.PATTERN_UNLOCK]: _unlockHelpers.default.patternUnlock,
    [_unlockHelpers.FINGERPRINT_UNLOCK]: _unlockHelpers.default.fingerprintUnlock
  }[unlockType];
  await unlockMethod(adb, driver, unlockCapabilities);
};

helpers.unlockWithHelperApp = async function unlockWithHelperApp(adb) {
  _logger.default.info('Unlocking screen');

  let firstRun = true;
  await (0, _asyncbox.retry)(3, async function launchHelper() {
    if (firstRun) {
      firstRun = false;
    } else {
      try {
        if (!(await adb.isScreenLocked())) {
          return;
        }
      } catch (e) {
        _logger.default.warn(`Error in isScreenLocked: ${e.message}`);

        _logger.default.warn('"adb shell dumpsys window" command has timed out.');

        _logger.default.warn('The reason of this timeout is the delayed adb response. Resetting adb server can improve it.');
      }
    }

    _logger.default.info(`Launching ${SETTINGS_HELPER_UNLOCK_ACTIVITY}`);

    await adb.shell(['am', 'start', '-n', `${SETTINGS_HELPER_PKG_ID}/${SETTINGS_HELPER_UNLOCK_ACTIVITY}`, '-c', 'android.intent.category.LAUNCHER', '-a', 'android.intent.action.MAIN', '-f', '0x10200000']);
    await _bluebird.default.delay(1000);
  });
};

helpers.unlock = async function unlock(driver, adb, capabilities) {
  if (!(await adb.isScreenLocked())) {
    _logger.default.info('Screen already unlocked, doing nothing');

    return;
  }

  _logger.default.debug('Screen is locked, trying to unlock');

  if (_lodash.default.isUndefined(capabilities.unlockType)) {
    _logger.default.warn('Using app unlock, this is going to be deprecated!');

    await helpers.unlockWithHelperApp(adb);
  } else {
    await helpers.unlockWithUIAutomation(driver, adb, {
      unlockType: capabilities.unlockType,
      unlockKey: capabilities.unlockKey
    });
    await helpers.verifyUnlock(adb, capabilities.unlockSuccessTimeout);
  }
};

helpers.verifyUnlock = async function verifyUnlock(adb, unlockSuccessTimeout) {
  let successTimeout = unlockSuccessTimeout || 2000;
  await (0, _asyncbox.retryInterval)(successTimeout / 1000, successTimeout, async () => {
    if (await adb.isScreenLocked()) {
      throw new Error('Screen did not unlock successfully, retrying');
    }

    _logger.default.debug('Screen unlocked successfully');
  });
};

helpers.initDevice = async function initDevice(adb, opts) {
  const {
    skipDeviceInitialization,
    locale,
    language,
    localeScript,
    unicodeKeyboard,
    disableWindowAnimation,
    skipUnlock,
    mockLocationApp,
    skipLogcatCapture,
    logcatFormat,
    logcatFilterSpecs
  } = opts;

  if (skipDeviceInitialization) {
    _logger.default.info(`'skipDeviceInitialization' is set. Skipping device initialization.`);
  } else {
    await adb.waitForDevice();
    const shouldThrowError = language || locale || localeScript || unicodeKeyboard || disableWindowAnimation || !skipUnlock;
    await helpers.pushSettingsApp(adb, shouldThrowError);
  }

  if (!helpers.isEmulator(adb, opts) && (mockLocationApp || _lodash.default.isUndefined(mockLocationApp))) {
    await helpers.setMockLocationApp(adb, mockLocationApp || SETTINGS_HELPER_PKG_ID);
  }

  if (language || locale) {
    await helpers.ensureDeviceLocale(adb, language, locale, localeScript);
  }

  if (skipLogcatCapture) {
    _logger.default.info(`'skipLogcatCapture' is set. Skipping starting logcat capture.`);
  } else {
    await adb.startLogcat({
      format: logcatFormat,
      filterSpecs: logcatFilterSpecs
    });
  }

  if (unicodeKeyboard) {
    return await helpers.initUnicodeKeyboard(adb);
  }
};

helpers.removeNullProperties = function removeNullProperties(obj) {
  for (let key of _lodash.default.keys(obj)) {
    if (_lodash.default.isNull(obj[key]) || _lodash.default.isUndefined(obj[key])) {
      delete obj[key];
    }
  }
};

helpers.truncateDecimals = function truncateDecimals(number, digits) {
  let multiplier = Math.pow(10, digits),
      adjustedNum = number * multiplier,
      truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);
  return truncatedNum / multiplier;
};

helpers.isChromeBrowser = function isChromeBrowser(browser) {
  return _lodash.default.includes(Object.keys(CHROME_BROWSER_PACKAGE_ACTIVITY), (browser || '').toLowerCase());
};

helpers.getChromePkg = function getChromePkg(browser) {
  return CHROME_BROWSER_PACKAGE_ACTIVITY[browser.toLowerCase()] || CHROME_BROWSER_PACKAGE_ACTIVITY.default;
};

helpers.removeAllSessionWebSocketHandlers = async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
};

helpers.parseArray = function parseArray(cap) {
  let parsedCaps;

  try {
    parsedCaps = JSON.parse(cap);
  } catch (ign) {}

  if (_lodash.default.isArray(parsedCaps)) {
    return parsedCaps;
  } else if (_lodash.default.isString(cap)) {
    return [cap];
  }

  throw new Error(`must provide a string or JSON Array; received ${cap}`);
};

helpers.validateDesiredCaps = function validateDesiredCaps(caps) {
  if (caps.browserName) {
    if (caps.app) {
      _logger.default.warn(`The desired capabilities should generally not include both an 'app' and a 'browserName'`);
    }

    if (caps.appPackage) {
      _logger.default.errorAndThrow(`The desired should not include both of an 'appPackage' and a 'browserName'`);
    }
  }

  if (caps.uninstallOtherPackages) {
    try {
      this.parseArray(caps.uninstallOtherPackages);
    } catch (e) {
      _logger.default.errorAndThrow(`Could not parse "uninstallOtherPackages" capability: ${e.message}`);
    }
  }

  return true;
};

helpers.adjustBrowserSessionCaps = function adjustBrowserSessionCaps(caps = {}) {
  const {
    browserName
  } = caps;

  _logger.default.info(`The current session is considered browser-based`);

  _logger.default.info(`Supported browser names: ${JSON.stringify(_lodash.default.keys(CHROME_BROWSER_PACKAGE_ACTIVITY))}`);

  if (caps.appPackage || caps.appActivity) {
    _logger.default.info(`Not overriding appPackage/appActivity capability values for '${browserName}' ` + 'because some of them have been already provided');

    return caps;
  }

  const {
    pkg,
    activity
  } = this.getChromePkg(browserName);
  caps.appPackage = pkg;
  caps.appActivity = activity;

  _logger.default.info(`appPackage/appActivity capabilities have been automatically set to ${pkg}/${activity} ` + `for '${browserName}'`);

  _logger.default.info(`Consider changing the browserName to the one from the list of supported browser names ` + `or provide custom appPackage/appActivity capability values if the automatically assigned ones do ` + `not make sense`);

  return caps;
};

helpers.isEmulator = function isEmulator(adb, opts) {
  const possibleNames = [opts.udid, adb === null || adb === void 0 ? void 0 : adb.curDeviceId];
  return !!opts.avd || possibleNames.some(x => EMULATOR_PATTERN.test(x));
};

helpers.bootstrap = _bootstrap.default;
helpers.unlocker = _unlockHelpers.default;
var _default = helpers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbmRyb2lkLWhlbHBlcnMuanMiXSwibmFtZXMiOlsiUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQiLCJDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZIiwiY2hyb21lIiwicGtnIiwiYWN0aXZpdHkiLCJjaHJvbWl1bSIsImNocm9tZWJldGEiLCJicm93c2VyIiwiZGVmYXVsdCIsIlNFVFRJTkdTX0hFTFBFUl9QS0dfSUQiLCJTRVRUSU5HU19IRUxQRVJfVU5MT0NLX0FDVElWSVRZIiwiRU1VTEFUT1JfUEFUVEVSTiIsImVuc3VyZU5ldHdvcmtTcGVlZCIsImFkYiIsIm5ldHdvcmtTcGVlZCIsIl8iLCJ2YWx1ZXMiLCJORVRXT1JLX1NQRUVEIiwiaW5jbHVkZXMiLCJsb2dnZXIiLCJ3YXJuIiwiRlVMTCIsInByZXBhcmVBdmRBcmdzIiwib3B0cyIsImlzSGVhZGxlc3MiLCJhdmRBcmdzIiwicmVzdWx0IiwiaXNBcnJheSIsInB1c2giLCJ1dGlsIiwic2hlbGxQYXJzZSIsImhlbHBlcnMiLCJjcmVhdGVCYXNlQURCIiwiYWRiUG9ydCIsInN1cHByZXNzS2lsbFNlcnZlciIsInJlbW90ZUFkYkhvc3QiLCJjbGVhckRldmljZUxvZ3NPblN0YXJ0IiwiYWRiRXhlY1RpbWVvdXQiLCJ1c2VLZXlzdG9yZSIsImtleXN0b3JlUGF0aCIsImtleXN0b3JlUGFzc3dvcmQiLCJrZXlBbGlhcyIsImtleVBhc3N3b3JkIiwicmVtb3RlQXBwc0NhY2hlTGltaXQiLCJidWlsZFRvb2xzVmVyc2lvbiIsImFsbG93T2ZmbGluZURldmljZXMiLCJhbGxvd0RlbGF5QWRiIiwiQURCIiwiY3JlYXRlQURCIiwicHJlcGFyZUVtdWxhdG9yIiwiYXZkIiwiYXZkRW52IiwiZW52IiwibGFuZ3VhZ2UiLCJsb2NhbGUiLCJjb3VudHJ5IiwiYXZkTGF1bmNoVGltZW91dCIsImxhdW5jaFRpbWVvdXQiLCJhdmRSZWFkeVRpbWVvdXQiLCJyZWFkeVRpbWVvdXQiLCJFcnJvciIsImF2ZE5hbWUiLCJyZXBsYWNlIiwicnVubmluZ0FWRCIsImdldFJ1bm5pbmdBVkQiLCJhcmdzIiwiZGVidWciLCJraWxsRW11bGF0b3IiLCJsYXVuY2hBVkQiLCJlbnN1cmVEZXZpY2VMb2NhbGUiLCJzY3JpcHQiLCJpc1N0cmluZyIsInNldERldmljZUxhbmd1YWdlQ291bnRyeSIsImVuc3VyZUN1cnJlbnRMb2NhbGUiLCJtZXNzYWdlIiwiZ2V0RGV2aWNlSW5mb0Zyb21DYXBzIiwidWRpZCIsImVtUG9ydCIsImN1ckRldmljZUlkIiwiZW11bGF0b3JQb3J0IiwiaW5mbyIsImRldmljZXMiLCJnZXREZXZpY2VzV2l0aFJldHJ5IiwibWFwIiwiZXJyb3JBbmRUaHJvdyIsImdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmciLCJwbGF0Zm9ybVZlcnNpb24iLCJ0cmltIiwic2VtdmVyIiwiY29lcmNlIiwiYXZhaWxEZXZpY2VzIiwicGFydGlhbE1hdGNoQ2FuZGlkYXRlIiwiZGV2aWNlIiwic2V0RGV2aWNlSWQiLCJyYXdEZXZpY2VPUyIsImdldFBsYXRmb3JtVmVyc2lvbiIsImRldmljZU9TIiwiYm90aFZlcnNpb25zQ2FuQmVDb2VyY2VkIiwidmFsaWQiLCJib3RoVmVyc2lvbnNBcmVTdHJpbmdzIiwidmVyc2lvbiIsInRvTG93ZXIiLCJtYWpvciIsIm1pbm9yIiwiZ3QiLCJrZXlzIiwiam9pbiIsInNldEVtdWxhdG9yUG9ydCIsInZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMiLCJrZXkiLCJuYW1lIiwibWF0Y2giLCJleGVjIiwiaW5kZXgiLCJzdWJzdHJpbmciLCJnZXRMYXVuY2hJbmZvIiwiYXBwIiwiYXBwUGFja2FnZSIsImFwcEFjdGl2aXR5IiwiYXBwV2FpdFBhY2thZ2UiLCJhcHBXYWl0QWN0aXZpdHkiLCJhcGtQYWNrYWdlIiwiYXBrQWN0aXZpdHkiLCJwYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QiLCJyZXNldEFwcCIsImZhc3RSZXNldCIsImZ1bGxSZXNldCIsImFuZHJvaWRJbnN0YWxsVGltZW91dCIsImF1dG9HcmFudFBlcm1pc3Npb25zIiwiYWxsb3dUZXN0UGFja2FnZXMiLCJpc0luc3RhbGxlZCIsImlzQXBwSW5zdGFsbGVkIiwiZm9yY2VTdG9wIiwiaWduIiwib3V0cHV0IiwiY2xlYXIiLCJ0b0xvd2VyQ2FzZSIsImdyYW50QWxsUGVybWlzc2lvbnMiLCJlcnJvciIsInVuaW5zdGFsbEFwayIsImluc3RhbGwiLCJncmFudFBlcm1pc3Npb25zIiwidGltZW91dCIsImluc3RhbGxBcGsiLCJlbmZvcmNlQXBwSW5zdGFsbCIsImFwcFN0YXRlIiwid2FzVW5pbnN0YWxsZWQiLCJpbnN0YWxsT3JVcGdyYWRlIiwiZW5mb3JjZUN1cnJlbnRCdWlsZCIsImlzSW5zdGFsbGVkT3ZlckV4aXN0aW5nQXBwIiwiQVBQX0lOU1RBTExfU1RBVEUiLCJOT1RfSU5TVEFMTEVEIiwiaW5zdGFsbE90aGVyQXBrcyIsIm90aGVyQXBwcyIsIkIiLCJhbGwiLCJvdGhlckFwcCIsInVuaW5zdGFsbE90aGVyUGFja2FnZXMiLCJhcHBQYWNrYWdlcyIsImZpbHRlclBhY2thZ2VzIiwiZ2V0VGhpcmRQYXJ0eVBhY2thZ2VzIiwicGFja2FnZXNTdHJpbmciLCJzaGVsbCIsImFwcFBhY2thZ2VzQXJyYXkiLCJzcGxpdCIsIkVPTCIsImRpZmZlcmVuY2UiLCJlcnIiLCJpbml0VW5pY29kZUtleWJvYXJkIiwiZGVmYXVsdElNRSIsImFwcGl1bUlNRSIsImVuYWJsZUlNRSIsInNldElNRSIsInNldE1vY2tMb2NhdGlvbkFwcCIsImdldEFwaUxldmVsIiwiaW5zdGFsbEhlbHBlckFwcCIsImFwa1BhdGgiLCJwYWNrYWdlSWQiLCJyZXRyeUluc3RhbGxIZWxwZXJBcHAiLCJwdXNoU2V0dGluZ3NBcHAiLCJ0aHJvd0Vycm9yIiwic2V0dGluZ3NBcGtQYXRoIiwicHJvY2Vzc0V4aXN0cyIsInBlcm1zIiwieCIsInJlcXVpcmVSdW5uaW5nU2V0dGluZ3NBcHAiLCJwdXNoU3RyaW5ncyIsInJlbW90ZURpciIsInN0cmluZ3NKc29uIiwicmVtb3RlRmlsZSIsInBhdGgiLCJwb3NpeCIsInJlc29sdmUiLCJyaW1yYWYiLCJwdWxsQXBrIiwidG1wRGlyIiwiaXNFbXB0eSIsImZzIiwiZXhpc3RzIiwic3RyaW5nc1RtcERpciIsImFwa1N0cmluZ3MiLCJsb2NhbFBhdGgiLCJleHRyYWN0U3RyaW5nc0Zyb21BcGsiLCJ1bmxvY2tXaXRoVUlBdXRvbWF0aW9uIiwiZHJpdmVyIiwidW5sb2NrQ2FwYWJpbGl0aWVzIiwidW5sb2NrVHlwZSIsInVubG9ja2VyIiwiaXNWYWxpZFVubG9ja1R5cGUiLCJ1bmxvY2tLZXkiLCJpc1ZhbGlkS2V5IiwidW5sb2NrTWV0aG9kIiwiUElOX1VOTE9DSyIsInBpblVubG9jayIsIlBBU1NXT1JEX1VOTE9DSyIsInBhc3N3b3JkVW5sb2NrIiwiUEFUVEVSTl9VTkxPQ0siLCJwYXR0ZXJuVW5sb2NrIiwiRklOR0VSUFJJTlRfVU5MT0NLIiwiZmluZ2VycHJpbnRVbmxvY2siLCJ1bmxvY2tXaXRoSGVscGVyQXBwIiwiZmlyc3RSdW4iLCJsYXVuY2hIZWxwZXIiLCJpc1NjcmVlbkxvY2tlZCIsImUiLCJkZWxheSIsInVubG9jayIsImNhcGFiaWxpdGllcyIsImlzVW5kZWZpbmVkIiwidmVyaWZ5VW5sb2NrIiwidW5sb2NrU3VjY2Vzc1RpbWVvdXQiLCJzdWNjZXNzVGltZW91dCIsImluaXREZXZpY2UiLCJza2lwRGV2aWNlSW5pdGlhbGl6YXRpb24iLCJsb2NhbGVTY3JpcHQiLCJ1bmljb2RlS2V5Ym9hcmQiLCJkaXNhYmxlV2luZG93QW5pbWF0aW9uIiwic2tpcFVubG9jayIsIm1vY2tMb2NhdGlvbkFwcCIsInNraXBMb2djYXRDYXB0dXJlIiwibG9nY2F0Rm9ybWF0IiwibG9nY2F0RmlsdGVyU3BlY3MiLCJ3YWl0Rm9yRGV2aWNlIiwic2hvdWxkVGhyb3dFcnJvciIsImlzRW11bGF0b3IiLCJzdGFydExvZ2NhdCIsImZvcm1hdCIsImZpbHRlclNwZWNzIiwicmVtb3ZlTnVsbFByb3BlcnRpZXMiLCJvYmoiLCJpc051bGwiLCJ0cnVuY2F0ZURlY2ltYWxzIiwibnVtYmVyIiwiZGlnaXRzIiwibXVsdGlwbGllciIsIk1hdGgiLCJwb3ciLCJhZGp1c3RlZE51bSIsInRydW5jYXRlZE51bSIsImlzQ2hyb21lQnJvd3NlciIsIk9iamVjdCIsImdldENocm9tZVBrZyIsInJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyIsInNlcnZlciIsInNlc3Npb25JZCIsImlzRnVuY3Rpb24iLCJnZXRXZWJTb2NrZXRIYW5kbGVycyIsImFjdGl2ZUhhbmRsZXJzIiwicGF0aG5hbWUiLCJyZW1vdmVXZWJTb2NrZXRIYW5kbGVyIiwicGFyc2VBcnJheSIsImNhcCIsInBhcnNlZENhcHMiLCJKU09OIiwicGFyc2UiLCJ2YWxpZGF0ZURlc2lyZWRDYXBzIiwiY2FwcyIsImJyb3dzZXJOYW1lIiwiYWRqdXN0QnJvd3NlclNlc3Npb25DYXBzIiwic3RyaW5naWZ5IiwicG9zc2libGVOYW1lcyIsInNvbWUiLCJ0ZXN0IiwiYm9vdHN0cmFwIiwiQm9vdHN0cmFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFJQTs7QUFDQTs7QUFFQSxNQUFNQSx1QkFBdUIsR0FBRyxLQUFoQztBQUVBLE1BQU1DLCtCQUErQixHQUFHO0FBQ3RDQyxFQUFBQSxNQUFNLEVBQUU7QUFDTkMsSUFBQUEsR0FBRyxFQUFFLG9CQURDO0FBRU5DLElBQUFBLFFBQVEsRUFBRTtBQUZKLEdBRDhCO0FBS3RDQyxFQUFBQSxRQUFRLEVBQUU7QUFDUkYsSUFBQUEsR0FBRyxFQUFFLDJCQURHO0FBRVJDLElBQUFBLFFBQVEsRUFBRTtBQUZGLEdBTDRCO0FBU3RDRSxFQUFBQSxVQUFVLEVBQUU7QUFDVkgsSUFBQUEsR0FBRyxFQUFFLGlCQURLO0FBRVZDLElBQUFBLFFBQVEsRUFBRTtBQUZBLEdBVDBCO0FBYXRDRyxFQUFBQSxP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LEdBQUQ7QUFBTUMsSUFBQUE7QUFBTixNQUFrQixLQUFLaVEsWUFBTCxDQUFrQmdCLFdBQWxCLENBQXhCO0FBQ0FELEVBQUFBLElBQUksQ0FBQy9KLFVBQUwsR0FBa0JsSCxHQUFsQjtBQUNBaVIsRUFBQUEsSUFBSSxDQUFDOUosV0FBTCxHQUFtQmxILFFBQW5COztBQUNBZSxrQkFBTzZELElBQVAsQ0FBYSxzRUFBcUU3RSxHQUFJLElBQUdDLFFBQVMsR0FBdEYsR0FDVCxRQUFPaVIsV0FBWSxHQUR0Qjs7QUFFQWxRLGtCQUFPNkQsSUFBUCxDQUFhLHdGQUFELEdBQ1QsbUdBRFMsR0FFVCxnQkFGSDs7QUFHQSxTQUFPb00sSUFBUDtBQUNELENBbkJEOztBQTRCQXJQLE9BQU8sQ0FBQ3FOLFVBQVIsR0FBcUIsU0FBU0EsVUFBVCxDQUFxQnZPLEdBQXJCLEVBQTBCVSxJQUExQixFQUFnQztBQUNuRCxRQUFNaVEsYUFBYSxHQUFHLENBQUNqUSxJQUFJLENBQUNxRCxJQUFOLEVBQVkvRCxHQUFaLGFBQVlBLEdBQVosdUJBQVlBLEdBQUcsQ0FBRWlFLFdBQWpCLENBQXRCO0FBQ0EsU0FBTyxDQUFDLENBQUN2RCxJQUFJLENBQUMyQixHQUFQLElBQWNzTyxhQUFhLENBQUNDLElBQWQsQ0FBb0JqRyxDQUFELElBQU83SyxnQkFBZ0IsQ0FBQytRLElBQWpCLENBQXNCbEcsQ0FBdEIsQ0FBMUIsQ0FBckI7QUFDRCxDQUhEOztBQUtBekosT0FBTyxDQUFDNFAsU0FBUixHQUFvQkMsa0JBQXBCO0FBQ0E3UCxPQUFPLENBQUNnTCxRQUFSLEdBQW1CQSxzQkFBbkI7ZUFHZWhMLE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyByZXRyeSwgcmV0cnlJbnRlcnZhbCB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgZnMsIHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBwYXRoIGFzIHNldHRpbmdzQXBrUGF0aCB9IGZyb20gJ2lvLmFwcGl1bS5zZXR0aW5ncyc7XG5pbXBvcnQgQm9vdHN0cmFwIGZyb20gJy4vYm9vdHN0cmFwJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBBREIgZnJvbSAnYXBwaXVtLWFkYic7XG5pbXBvcnQge1xuICBkZWZhdWx0IGFzIHVubG9ja2VyLCBQSU5fVU5MT0NLLCBQQVNTV09SRF9VTkxPQ0ssXG4gIFBBVFRFUk5fVU5MT0NLLCBGSU5HRVJQUklOVF9VTkxPQ0tcbn0gZnJvbSAnLi91bmxvY2staGVscGVycyc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5cbmNvbnN0IFBBQ0tBR0VfSU5TVEFMTF9USU1FT1VUID0gOTAwMDA7IC8vIG1pbGxpc2Vjb25kc1xuLy8gaHR0cHM6Ly9jcy5jaHJvbWl1bS5vcmcvY2hyb21pdW0vc3JjL2Nocm9tZS9icm93c2VyL2RldnRvb2xzL2RldmljZS9hbmRyb2lkX2RldmljZV9pbmZvX3F1ZXJ5LmNjXG5jb25zdCBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZID0ge1xuICBjaHJvbWU6IHtcbiAgICBwa2c6ICdjb20uYW5kcm9pZC5jaHJvbWUnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxuICBjaHJvbWl1bToge1xuICAgIHBrZzogJ29yZy5jaHJvbWl1bS5jaHJvbWUuc2hlbGwnLFxuICAgIGFjdGl2aXR5OiAnLkNocm9tZVNoZWxsQWN0aXZpdHknLFxuICB9LFxuICBjaHJvbWViZXRhOiB7XG4gICAgcGtnOiAnY29tLmNocm9tZS5iZXRhJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbiAgYnJvd3Nlcjoge1xuICAgIHBrZzogJ2NvbS5hbmRyb2lkLmJyb3dzZXInLFxuICAgIGFjdGl2aXR5OiAnY29tLmFuZHJvaWQuYnJvd3Nlci5Ccm93c2VyQWN0aXZpdHknLFxuICB9LFxuICAnY2hyb21pdW0tYnJvd3Nlcic6IHtcbiAgICBwa2c6ICdvcmcuY2hyb21pdW0uY2hyb21lJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbiAgJ2Nocm9taXVtLXdlYnZpZXcnOiB7XG4gICAgcGtnOiAnb3JnLmNocm9taXVtLndlYnZpZXdfc2hlbGwnLFxuICAgIGFjdGl2aXR5OiAnb3JnLmNocm9taXVtLndlYnZpZXdfc2hlbGwuV2ViVmlld0Jyb3dzZXJBY3Rpdml0eScsXG4gIH0sXG4gIGRlZmF1bHQ6IHtcbiAgICBwa2c6ICdjb20uYW5kcm9pZC5jaHJvbWUnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxufTtcbmNvbnN0IFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQgPSAnaW8uYXBwaXVtLnNldHRpbmdzJztcbmNvbnN0IFNFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFkgPSAnLlVubG9jayc7XG5jb25zdCBFTVVMQVRPUl9QQVRURVJOID0gL1xcYmVtdWxhdG9yXFxiL2k7XG5cblxuZnVuY3Rpb24gZW5zdXJlTmV0d29ya1NwZWVkIChhZGIsIG5ldHdvcmtTcGVlZCkge1xuICBpZiAoXy52YWx1ZXMoYWRiLk5FVFdPUktfU1BFRUQpLmluY2x1ZGVzKG5ldHdvcmtTcGVlZCkpIHtcbiAgICByZXR1cm4gbmV0d29ya1NwZWVkO1xuICB9XG4gIGxvZ2dlci53YXJuKGBXcm9uZyBuZXR3b3JrIHNwZWVkIHBhcmFtICcke25ldHdvcmtTcGVlZH0nLCB1c2luZyBkZWZhdWx0OiAke2FkYi5ORVRXT1JLX1NQRUVELkZVTEx9LiBgICtcbiAgICBgU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhhZGIuTkVUV09SS19TUEVFRCl9YCk7XG4gIHJldHVybiBhZGIuTkVUV09SS19TUEVFRC5GVUxMO1xufVxuXG5mdW5jdGlvbiBwcmVwYXJlQXZkQXJncyAoYWRiLCBvcHRzKSB7XG4gIGNvbnN0IHtcbiAgICBuZXR3b3JrU3BlZWQsXG4gICAgaXNIZWFkbGVzcyxcbiAgICBhdmRBcmdzLFxuICB9ID0gb3B0cztcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGlmIChhdmRBcmdzKSB7XG4gICAgaWYgKF8uaXNBcnJheShhdmRBcmdzKSkge1xuICAgICAgcmVzdWx0LnB1c2goLi4uYXZkQXJncyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdC5wdXNoKC4uLih1dGlsLnNoZWxsUGFyc2UoYCR7YXZkQXJnc31gKSkpO1xuICAgIH1cbiAgfVxuICBpZiAobmV0d29ya1NwZWVkKSB7XG4gICAgcmVzdWx0LnB1c2goJy1uZXRzcGVlZCcsIGVuc3VyZU5ldHdvcmtTcGVlZChhZGIsIG5ldHdvcmtTcGVlZCkpO1xuICB9XG4gIGlmIChpc0hlYWRsZXNzKSB7XG4gICAgcmVzdWx0LnB1c2goJy1uby13aW5kb3cnKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5cbmNvbnN0IGhlbHBlcnMgPSB7fTtcblxuaGVscGVycy5jcmVhdGVCYXNlQURCID0gYXN5bmMgZnVuY3Rpb24gY3JlYXRlQmFzZUFEQiAob3B0cyA9IHt9KSB7XG4gIC8vIGZpbHRlciBvdXQgYW55IHVud2FudGVkIG9wdGlvbnMgc2VudCBpblxuICAvLyB0aGlzIGxpc3Qgc2hvdWxkIGJlIHVwZGF0ZWQgYXMgQURCIHRha2VzIG1vcmUgYXJndW1lbnRzXG4gIGNvbnN0IHtcbiAgICBhZGJQb3J0LFxuICAgIHN1cHByZXNzS2lsbFNlcnZlcixcbiAgICByZW1vdGVBZGJIb3N0LFxuICAgIGNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgYWRiRXhlY1RpbWVvdXQsXG4gICAgdXNlS2V5c3RvcmUsXG4gICAga2V5c3RvcmVQYXRoLFxuICAgIGtleXN0b3JlUGFzc3dvcmQsXG4gICAga2V5QWxpYXMsXG4gICAga2V5UGFzc3dvcmQsXG4gICAgcmVtb3RlQXBwc0NhY2hlTGltaXQsXG4gICAgYnVpbGRUb29sc1ZlcnNpb24sXG4gICAgYWxsb3dPZmZsaW5lRGV2aWNlcyxcbiAgICBhbGxvd0RlbGF5QWRiLFxuICB9ID0gb3B0cztcbiAgcmV0dXJuIGF3YWl0IEFEQi5jcmVhdGVBREIoe1xuICAgIGFkYlBvcnQsXG4gICAgc3VwcHJlc3NLaWxsU2VydmVyLFxuICAgIHJlbW90ZUFkYkhvc3QsXG4gICAgY2xlYXJEZXZpY2VMb2dzT25TdGFydCxcbiAgICBhZGJFeGVjVGltZW91dCxcbiAgICB1c2VLZXlzdG9yZSxcbiAgICBrZXlzdG9yZVBhdGgsXG4gICAga2V5c3RvcmVQYXNzd29yZCxcbiAgICBrZXlBbGlhcyxcbiAgICBrZXlQYXNzd29yZCxcbiAgICByZW1vdGVBcHBzQ2FjaGVMaW1pdCxcbiAgICBidWlsZFRvb2xzVmVyc2lvbixcbiAgICBhbGxvd09mZmxpbmVEZXZpY2VzLFxuICAgIGFsbG93RGVsYXlBZGIsXG4gIH0pO1xufTtcblxuaGVscGVycy5wcmVwYXJlRW11bGF0b3IgPSBhc3luYyBmdW5jdGlvbiBwcmVwYXJlRW11bGF0b3IgKGFkYiwgb3B0cykge1xuICBjb25zdCB7XG4gICAgYXZkLFxuICAgIGF2ZEVudjogZW52LFxuICAgIGxhbmd1YWdlLFxuICAgIGxvY2FsZTogY291bnRyeSxcbiAgICBhdmRMYXVuY2hUaW1lb3V0OiBsYXVuY2hUaW1lb3V0LFxuICAgIGF2ZFJlYWR5VGltZW91dDogcmVhZHlUaW1lb3V0LFxuICB9ID0gb3B0cztcbiAgaWYgKCFhdmQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBsYXVuY2ggQVZEIHdpdGhvdXQgQVZEIG5hbWUnKTtcbiAgfVxuXG4gIGNvbnN0IGF2ZE5hbWUgPSBhdmQucmVwbGFjZSgnQCcsICcnKTtcbiAgY29uc3QgcnVubmluZ0FWRCA9IGF3YWl0IGFkYi5nZXRSdW5uaW5nQVZEKGF2ZE5hbWUpO1xuICBjb25zdCBhcmdzID0gcHJlcGFyZUF2ZEFyZ3MoYWRiLCBvcHRzKTtcbiAgaWYgKHJ1bm5pbmdBVkQpIHtcbiAgICBpZiAoYXJncy5pbmNsdWRlcygnLXdpcGUtZGF0YScpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEtpbGxpbmcgJyR7YXZkTmFtZX0nIGJlY2F1c2UgaXQgbmVlZHMgdG8gYmUgd2lwZWQgYXQgc3RhcnQuYCk7XG4gICAgICBhd2FpdCBhZGIua2lsbEVtdWxhdG9yKGF2ZE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ05vdCBsYXVuY2hpbmcgQVZEIGJlY2F1c2UgaXQgaXMgYWxyZWFkeSBydW5uaW5nLicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBhd2FpdCBhZGIubGF1bmNoQVZEKGF2ZCwge1xuICAgIGFyZ3MsXG4gICAgZW52LFxuICAgIGxhbmd1YWdlLFxuICAgIGNvdW50cnksXG4gICAgbGF1bmNoVGltZW91dCxcbiAgICByZWFkeVRpbWVvdXQsXG4gIH0pO1xufTtcblxuLyoqXG4gKiBTZXQgYW5kIGVuc3VyZSB0aGUgbG9jYWxlIG5hbWUgb2YgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBhZGIgLSBUaGUgYWRiIG1vZHVsZSBpbnN0YW5jZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSAtIExhbmd1YWdlLiBUaGUgbGFuZ3VhZ2UgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byBsb3dlciBjYXNlLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBbYS16QS1aXXsyLDh9LiBlLmcuIGVuLCBqYSA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb3VudHJ5IC0gQ291bnRyeS4gVGhlIGNvdW50cnkgKHJlZ2lvbikgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSwgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byB1cHBlciBjYXNlLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBbYS16QS1aXXsyfSB8IFswLTldezN9LiBlLmcuIFVTLCBKUCA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqIEBwYXJhbSB7P3N0cmluZ30gc2NyaXB0IC0gU2NyaXB0LiBUaGUgc2NyaXB0IGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byB0aXRsZSBjYXNlLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBbYS16QS1aXXs0fS4gZS5nLiBIYW5zIGluIHpoLUhhbnMtQ04gOiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvamF2YS91dGlsL0xvY2FsZS5odG1sXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgaXQgZmFpbGVkIHRvIHNldCBsb2NhbGUgcHJvcGVybHlcbiAqL1xuaGVscGVycy5lbnN1cmVEZXZpY2VMb2NhbGUgPSBhc3luYyBmdW5jdGlvbiBlbnN1cmVEZXZpY2VMb2NhbGUgKGFkYiwgbGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCA9IG51bGwpIHtcbiAgaWYgKCFfLmlzU3RyaW5nKGxhbmd1YWdlKSAmJiAhXy5pc1N0cmluZyhjb3VudHJ5KSkge1xuICAgIGxvZ2dlci53YXJuKGBzZXREZXZpY2VMYW5ndWFnZUNvdW50cnkgcmVxdWlyZXMgbGFuZ3VhZ2Ugb3IgY291bnRyeS5gKTtcbiAgICBsb2dnZXIud2FybihgR290IGxhbmd1YWdlOiAnJHtsYW5ndWFnZX0nIGFuZCBjb3VudHJ5OiAnJHtjb3VudHJ5fSdgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBhd2FpdCBhZGIuc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5KGxhbmd1YWdlLCBjb3VudHJ5LCBzY3JpcHQpO1xuXG4gIGlmICghYXdhaXQgYWRiLmVuc3VyZUN1cnJlbnRMb2NhbGUobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCkpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gc2NyaXB0ID8gYGxhbmd1YWdlOiAke2xhbmd1YWdlfSwgY291bnRyeTogJHtjb3VudHJ5fSBhbmQgc2NyaXB0OiAke3NjcmlwdH1gIDogYGxhbmd1YWdlOiAke2xhbmd1YWdlfSBhbmQgY291bnRyeTogJHtjb3VudHJ5fWA7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gc2V0ICR7bWVzc2FnZX1gKTtcbiAgfVxufTtcblxuaGVscGVycy5nZXREZXZpY2VJbmZvRnJvbUNhcHMgPSBhc3luYyBmdW5jdGlvbiBnZXREZXZpY2VJbmZvRnJvbUNhcHMgKG9wdHMgPSB7fSkge1xuICAvLyB3ZSBjYW4gY3JlYXRlIGEgdGhyb3dhd2F5IEFEQiBpbnN0YW5jZSBoZXJlLCBzbyB0aGVyZSBpcyBubyBkZXBlbmRlbmN5XG4gIC8vIG9uIGluc3RhbnRpYXRpbmcgb24gZWFybGllciAoYXQgdGhpcyBwb2ludCwgd2UgaGF2ZSBubyB1ZGlkKVxuICAvLyB3ZSBjYW4gb25seSB1c2UgdGhpcyBBREIgb2JqZWN0IGZvciBjb21tYW5kcyB0aGF0IHdvdWxkIG5vdCBiZSBjb25mdXNlZFxuICAvLyBpZiBtdWx0aXBsZSBkZXZpY2VzIGFyZSBjb25uZWN0ZWRcbiAgY29uc3QgYWRiID0gYXdhaXQgaGVscGVycy5jcmVhdGVCYXNlQURCKG9wdHMpO1xuICBsZXQgdWRpZCA9IG9wdHMudWRpZDtcbiAgbGV0IGVtUG9ydCA9IG51bGw7XG5cbiAgLy8gYSBzcGVjaWZpYyBhdmQgbmFtZSB3YXMgZ2l2ZW4uIHRyeSB0byBpbml0aWFsaXplIHdpdGggdGhhdFxuICBpZiAob3B0cy5hdmQpIHtcbiAgICBhd2FpdCBoZWxwZXJzLnByZXBhcmVFbXVsYXRvcihhZGIsIG9wdHMpO1xuICAgIHVkaWQgPSBhZGIuY3VyRGV2aWNlSWQ7XG4gICAgZW1Qb3J0ID0gYWRiLmVtdWxhdG9yUG9ydDtcbiAgfSBlbHNlIHtcbiAgICAvLyBubyBhdmQgZ2l2ZW4uIGxldHMgdHJ5IHdoYXRldmVyJ3MgcGx1Z2dlZCBpbiBkZXZpY2VzL2VtdWxhdG9yc1xuICAgIGxvZ2dlci5pbmZvKCdSZXRyaWV2aW5nIGRldmljZSBsaXN0Jyk7XG4gICAgbGV0IGRldmljZXMgPSBhd2FpdCBhZGIuZ2V0RGV2aWNlc1dpdGhSZXRyeSgpO1xuXG4gICAgLy8gdWRpZCB3YXMgZ2l2ZW4sIGxldHMgdHJ5IHRvIGluaXQgd2l0aCB0aGF0IGRldmljZVxuICAgIGlmICh1ZGlkKSB7XG4gICAgICBpZiAoIV8uaW5jbHVkZXMoXy5tYXAoZGV2aWNlcywgJ3VkaWQnKSwgdWRpZCkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYERldmljZSAke3VkaWR9IHdhcyBub3QgaW4gdGhlIGxpc3Qgb2YgY29ubmVjdGVkIGRldmljZXNgKTtcbiAgICAgIH1cbiAgICAgIGVtUG9ydCA9IGFkYi5nZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nKHVkaWQpO1xuICAgIH0gZWxzZSBpZiAob3B0cy5wbGF0Zm9ybVZlcnNpb24pIHtcbiAgICAgIG9wdHMucGxhdGZvcm1WZXJzaW9uID0gYCR7b3B0cy5wbGF0Zm9ybVZlcnNpb259YC50cmltKCk7XG5cbiAgICAgIC8vIGEgcGxhdGZvcm0gdmVyc2lvbiB3YXMgZ2l2ZW4uIGxldHMgdHJ5IHRvIGZpbmQgYSBkZXZpY2Ugd2l0aCB0aGUgc2FtZSBvc1xuICAgICAgY29uc3QgcGxhdGZvcm1WZXJzaW9uID0gc2VtdmVyLmNvZXJjZShvcHRzLnBsYXRmb3JtVmVyc2lvbikgfHwgb3B0cy5wbGF0Zm9ybVZlcnNpb247XG4gICAgICBsb2dnZXIuaW5mbyhgTG9va2luZyBmb3IgYSBkZXZpY2Ugd2l0aCBBbmRyb2lkICcke3BsYXRmb3JtVmVyc2lvbn0nYCk7XG5cbiAgICAgIC8vIGluIGNhc2Ugd2UgZmFpbCB0byBmaW5kIHNvbWV0aGluZywgZ2l2ZSB0aGUgdXNlciBhIHVzZWZ1bCBsb2cgdGhhdCBoYXNcbiAgICAgIC8vIHRoZSBkZXZpY2UgdWRpZHMgYW5kIG9zIHZlcnNpb25zIHNvIHRoZXkga25vdyB3aGF0J3MgYXZhaWxhYmxlXG4gICAgICBjb25zdCBhdmFpbERldmljZXMgPSBbXTtcbiAgICAgIGxldCBwYXJ0aWFsTWF0Y2hDYW5kaWRhdGUgPSBudWxsO1xuICAgICAgLy8gZmlyc3QgdHJ5IHN0YXJ0ZWQgZGV2aWNlcy9lbXVsYXRvcnNcbiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIGRldmljZXMpIHtcbiAgICAgICAgLy8gZGlyZWN0IGFkYiBjYWxscyB0byB0aGUgc3BlY2lmaWMgZGV2aWNlXG4gICAgICAgIGF3YWl0IGFkYi5zZXREZXZpY2VJZChkZXZpY2UudWRpZCk7XG4gICAgICAgIGNvbnN0IHJhd0RldmljZU9TID0gYXdhaXQgYWRiLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgICAgICAvLyBUaGUgZGV2aWNlIE9TIGNvdWxkIGVpdGhlciBiZSBhIG51bWJlciwgbGlrZSBgNi4wYFxuICAgICAgICAvLyBvciBhbiBhYmJyZXZpYXRpb24sIGxpa2UgYFJgXG4gICAgICAgIGF2YWlsRGV2aWNlcy5wdXNoKGAke2RldmljZS51ZGlkfSAoJHtyYXdEZXZpY2VPU30pYCk7XG4gICAgICAgIGNvbnN0IGRldmljZU9TID0gc2VtdmVyLmNvZXJjZShyYXdEZXZpY2VPUykgfHwgcmF3RGV2aWNlT1M7XG4gICAgICAgIGlmICghZGV2aWNlT1MpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJvdGhWZXJzaW9uc0NhbkJlQ29lcmNlZCA9IHNlbXZlci52YWxpZChkZXZpY2VPUykgJiYgc2VtdmVyLnZhbGlkKHBsYXRmb3JtVmVyc2lvbik7XG4gICAgICAgIGNvbnN0IGJvdGhWZXJzaW9uc0FyZVN0cmluZ3MgPSBfLmlzU3RyaW5nKGRldmljZU9TKSAmJiBfLmlzU3RyaW5nKHBsYXRmb3JtVmVyc2lvbik7XG4gICAgICAgIGlmIChib3RoVmVyc2lvbnNDYW5CZUNvZXJjZWQgJiYgZGV2aWNlT1MudmVyc2lvbiA9PT0gcGxhdGZvcm1WZXJzaW9uLnZlcnNpb25cbiAgICAgICAgICAgIHx8IGJvdGhWZXJzaW9uc0FyZVN0cmluZ3MgJiYgXy50b0xvd2VyKGRldmljZU9TKSA9PT0gXy50b0xvd2VyKHBsYXRmb3JtVmVyc2lvbikpIHtcbiAgICAgICAgICAvLyBHb3QgYW4gZXhhY3QgbWF0Y2ggLSBwcm9jZWVkIGltbWVkaWF0ZWx5XG4gICAgICAgICAgdWRpZCA9IGRldmljZS51ZGlkO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9IGVsc2UgaWYgKCFib3RoVmVyc2lvbnNDYW5CZUNvZXJjZWQpIHtcbiAgICAgICAgICAvLyBUaGVyZSBpcyBubyBwb2ludCB0byBjaGVjayBmb3IgcGFydGlhbCBtYXRjaCBpZiBlaXRoZXIgb2YgdmVyc2lvbiBudW1iZXJzIGlzIG5vdCBjb2VyY2libGVcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgoIV8uaW5jbHVkZXMob3B0cy5wbGF0Zm9ybVZlcnNpb24sICcuJykgJiYgcGxhdGZvcm1WZXJzaW9uLm1ham9yID09PSBkZXZpY2VPUy5tYWpvclxuICAgICAgICAgICAgfHwgcGxhdGZvcm1WZXJzaW9uLm1ham9yID09PSBkZXZpY2VPUy5tYWpvciAmJiBwbGF0Zm9ybVZlcnNpb24ubWlub3IgPT09IGRldmljZU9TLm1pbm9yKVxuICAgICAgICAgICAgLy8gR290IGEgcGFydGlhbCBtYXRjaCAtIG1ha2Ugc3VyZSB3ZSBjb25zaWRlciB0aGUgbW9zdCByZWNlbnRcbiAgICAgICAgICAgIC8vIGRldmljZSB2ZXJzaW9uIGF2YWlsYWJsZSBvbiB0aGUgaG9zdCBzeXN0ZW1cbiAgICAgICAgICAgICYmIChwYXJ0aWFsTWF0Y2hDYW5kaWRhdGUgJiYgc2VtdmVyLmd0KGRldmljZU9TLCBfLnZhbHVlcyhwYXJ0aWFsTWF0Y2hDYW5kaWRhdGUpWzBdKVxuICAgICAgICAgICAgICAgIHx8ICFwYXJ0aWFsTWF0Y2hDYW5kaWRhdGUpKSB7XG4gICAgICAgICAgcGFydGlhbE1hdGNoQ2FuZGlkYXRlID0ge1tkZXZpY2UudWRpZF06IGRldmljZU9TfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCF1ZGlkICYmIHBhcnRpYWxNYXRjaENhbmRpZGF0ZSkge1xuICAgICAgICB1ZGlkID0gXy5rZXlzKHBhcnRpYWxNYXRjaENhbmRpZGF0ZSlbMF07XG4gICAgICAgIGF3YWl0IGFkYi5zZXREZXZpY2VJZCh1ZGlkKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF1ZGlkKSB7XG4gICAgICAgIC8vIHdlIGNvdWxkbid0IGZpbmQgYW55dGhpbmchIHF1aXRcbiAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFVuYWJsZSB0byBmaW5kIGFuIGFjdGl2ZSBkZXZpY2Ugb3IgZW11bGF0b3IgYCArXG4gICAgICAgICAgYHdpdGggT1MgJHtvcHRzLnBsYXRmb3JtVmVyc2lvbn0uIFRoZSBmb2xsb3dpbmcgYXJlIGF2YWlsYWJsZTogYCArXG4gICAgICAgICAgYXZhaWxEZXZpY2VzLmpvaW4oJywgJykpO1xuICAgICAgfVxuXG4gICAgICBlbVBvcnQgPSBhZGIuZ2V0UG9ydEZyb21FbXVsYXRvclN0cmluZyh1ZGlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYSB1ZGlkIHdhcyBub3QgZ2l2ZW4sIGdyYWIgdGhlIGZpcnN0IGRldmljZSB3ZSBzZWVcbiAgICAgIHVkaWQgPSBkZXZpY2VzWzBdLnVkaWQ7XG4gICAgICBlbVBvcnQgPSBhZGIuZ2V0UG9ydEZyb21FbXVsYXRvclN0cmluZyh1ZGlkKTtcbiAgICB9XG4gIH1cblxuICBsb2dnZXIuaW5mbyhgVXNpbmcgZGV2aWNlOiAke3VkaWR9YCk7XG4gIHJldHVybiB7dWRpZCwgZW1Qb3J0fTtcbn07XG5cbi8vIHJldHVybnMgYSBuZXcgYWRiIGluc3RhbmNlIHdpdGggZGV2aWNlSWQgc2V0XG5oZWxwZXJzLmNyZWF0ZUFEQiA9IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFEQiAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHt1ZGlkLCBlbVBvcnR9ID0gb3B0cztcbiAgY29uc3QgYWRiID0gYXdhaXQgaGVscGVycy5jcmVhdGVCYXNlQURCKG9wdHMpO1xuICBhZGIuc2V0RGV2aWNlSWQodWRpZCk7XG4gIGlmIChlbVBvcnQpIHtcbiAgICBhZGIuc2V0RW11bGF0b3JQb3J0KGVtUG9ydCk7XG4gIH1cblxuICByZXR1cm4gYWRiO1xufTtcblxuaGVscGVycy52YWxpZGF0ZVBhY2thZ2VBY3Rpdml0eU5hbWVzID0gZnVuY3Rpb24gdmFsaWRhdGVQYWNrYWdlQWN0aXZpdHlOYW1lcyAob3B0cykge1xuICBmb3IgKGNvbnN0IGtleSBvZiBbJ2FwcFBhY2thZ2UnLCAnYXBwQWN0aXZpdHknLCAnYXBwV2FpdFBhY2thZ2UnLCAnYXBwV2FpdEFjdGl2aXR5J10pIHtcbiAgICBjb25zdCBuYW1lID0gb3B0c1trZXldO1xuICAgIGlmICghbmFtZSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgY29uc3QgbWF0Y2ggPSAvKFteXFx3LiosXSkrLy5leGVjKG5hbWUpO1xuICAgIGlmICghbWF0Y2gpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGxvZ2dlci53YXJuKGBDYXBhYmlsaXR5ICcke2tleX0nIGlzIGV4cGVjdGVkIHRvIG9ubHkgaW5jbHVkZSBsYXRpbiBsZXR0ZXJzLCBkaWdpdHMsIHVuZGVyc2NvcmUsIGRvdCwgY29tbWEgYW5kIGFzdGVyaXNrIGNoYXJhY3RlcnMuYCk7XG4gICAgbG9nZ2VyLndhcm4oYEN1cnJlbnQgdmFsdWUgJyR7bmFtZX0nIGhhcyBub24tbWF0Y2hpbmcgY2hhcmFjdGVyIGF0IGluZGV4ICR7bWF0Y2guaW5kZXh9OiAnJHtuYW1lLnN1YnN0cmluZygwLCBtYXRjaC5pbmRleCArIDEpfSdgKTtcbiAgfVxufTtcblxuaGVscGVycy5nZXRMYXVuY2hJbmZvID0gYXN5bmMgZnVuY3Rpb24gZ2V0TGF1bmNoSW5mbyAoYWRiLCBvcHRzKSB7XG4gIGxldCB7YXBwLCBhcHBQYWNrYWdlLCBhcHBBY3Rpdml0eSwgYXBwV2FpdFBhY2thZ2UsIGFwcFdhaXRBY3Rpdml0eX0gPSBvcHRzO1xuICBpZiAoIWFwcCkge1xuICAgIGxvZ2dlci53YXJuKCdObyBhcHAgc2VudCBpbiwgbm90IHBhcnNpbmcgcGFja2FnZS9hY3Rpdml0eScpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMudmFsaWRhdGVQYWNrYWdlQWN0aXZpdHlOYW1lcyhvcHRzKTtcblxuICBpZiAoYXBwUGFja2FnZSAmJiBhcHBBY3Rpdml0eSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZygnUGFyc2luZyBwYWNrYWdlIGFuZCBhY3Rpdml0eSBmcm9tIGFwcCBtYW5pZmVzdCcpO1xuICBsZXQge2Fwa1BhY2thZ2UsIGFwa0FjdGl2aXR5fSA9XG4gICAgYXdhaXQgYWRiLnBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdChhcHApO1xuICBpZiAoYXBrUGFja2FnZSAmJiAhYXBwUGFja2FnZSkge1xuICAgIGFwcFBhY2thZ2UgPSBhcGtQYWNrYWdlO1xuICB9XG4gIGlmICghYXBwV2FpdFBhY2thZ2UpIHtcbiAgICBhcHBXYWl0UGFja2FnZSA9IGFwcFBhY2thZ2U7XG4gIH1cbiAgaWYgKGFwa0FjdGl2aXR5ICYmICFhcHBBY3Rpdml0eSkge1xuICAgIGFwcEFjdGl2aXR5ID0gYXBrQWN0aXZpdHk7XG4gIH1cbiAgaWYgKCFhcHBXYWl0QWN0aXZpdHkpIHtcbiAgICBhcHBXYWl0QWN0aXZpdHkgPSBhcHBBY3Rpdml0eTtcbiAgfVxuICBsb2dnZXIuZGVidWcoYFBhcnNlZCBwYWNrYWdlIGFuZCBhY3Rpdml0eSBhcmU6ICR7YXBrUGFja2FnZX0vJHthcGtBY3Rpdml0eX1gKTtcbiAgcmV0dXJuIHthcHBQYWNrYWdlLCBhcHBXYWl0UGFja2FnZSwgYXBwQWN0aXZpdHksIGFwcFdhaXRBY3Rpdml0eX07XG59O1xuXG5oZWxwZXJzLnJlc2V0QXBwID0gYXN5bmMgZnVuY3Rpb24gcmVzZXRBcHAgKGFkYiwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBhcHAsXG4gICAgYXBwUGFja2FnZSxcbiAgICBmYXN0UmVzZXQsXG4gICAgZnVsbFJlc2V0LFxuICAgIGFuZHJvaWRJbnN0YWxsVGltZW91dCA9IFBBQ0tBR0VfSU5TVEFMTF9USU1FT1VULFxuICAgIGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgIGFsbG93VGVzdFBhY2thZ2VzXG4gIH0gPSBvcHRzO1xuXG4gIGlmICghYXBwUGFja2FnZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHBQYWNrYWdlJyBvcHRpb24gaXMgcmVxdWlyZWRcIik7XG4gIH1cblxuICBjb25zdCBpc0luc3RhbGxlZCA9IGF3YWl0IGFkYi5pc0FwcEluc3RhbGxlZChhcHBQYWNrYWdlKTtcblxuICBpZiAoaXNJbnN0YWxsZWQpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgYWRiLmZvcmNlU3RvcChhcHBQYWNrYWdlKTtcbiAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgLy8gZnVsbFJlc2V0IGhhcyBwcmlvcml0eSBvdmVyIGZhc3RSZXNldFxuICAgIGlmICghZnVsbFJlc2V0ICYmIGZhc3RSZXNldCkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgYWRiLmNsZWFyKGFwcFBhY2thZ2UpO1xuICAgICAgaWYgKF8uaXNTdHJpbmcob3V0cHV0KSAmJiBvdXRwdXQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnZmFpbGVkJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2xlYXIgdGhlIGFwcGxpY2F0aW9uIGRhdGEgb2YgJyR7YXBwUGFja2FnZX0nLiBPcmlnaW5hbCBlcnJvcjogJHtvdXRwdXR9YCk7XG4gICAgICB9XG4gICAgICAvLyBleGVjdXRpbmcgYHNoZWxsIHBtIGNsZWFyYCByZXNldHMgcHJldmlvdXNseSBhc3NpZ25lZCBhcHBsaWNhdGlvbiBwZXJtaXNzaW9ucyBhcyB3ZWxsXG4gICAgICBpZiAoYXV0b0dyYW50UGVybWlzc2lvbnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBhZGIuZ3JhbnRBbGxQZXJtaXNzaW9ucyhhcHBQYWNrYWdlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBsb2dnZXIuZXJyb3IoYFVuYWJsZSB0byBncmFudCBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQuIE9yaWdpbmFsIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUGVyZm9ybWVkIGZhc3QgcmVzZXQgb24gdGhlIGluc3RhbGxlZCAnJHthcHBQYWNrYWdlfScgYXBwbGljYXRpb24gKHN0b3AgYW5kIGNsZWFyKWApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIGlmICghYXBwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiJ2FwcCcgb3B0aW9uIGlzIHJlcXVpcmVkIGZvciByZWluc3RhbGxcIik7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoYFJ1bm5pbmcgZnVsbCByZXNldCBvbiAnJHthcHBQYWNrYWdlfScgKHJlaW5zdGFsbClgKTtcbiAgaWYgKGlzSW5zdGFsbGVkKSB7XG4gICAgYXdhaXQgYWRiLnVuaW5zdGFsbEFwayhhcHBQYWNrYWdlKTtcbiAgfVxuICBhd2FpdCBhZGIuaW5zdGFsbChhcHAsIHtcbiAgICBncmFudFBlcm1pc3Npb25zOiBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICB0aW1lb3V0OiBhbmRyb2lkSW5zdGFsbFRpbWVvdXQsXG4gICAgYWxsb3dUZXN0UGFja2FnZXMsXG4gIH0pO1xufTtcblxuaGVscGVycy5pbnN0YWxsQXBrID0gYXN5bmMgZnVuY3Rpb24gaW5zdGFsbEFwayAoYWRiLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGFwcCxcbiAgICBhcHBQYWNrYWdlLFxuICAgIGZhc3RSZXNldCxcbiAgICBmdWxsUmVzZXQsXG4gICAgYW5kcm9pZEluc3RhbGxUaW1lb3V0ID0gUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQsXG4gICAgYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgYWxsb3dUZXN0UGFja2FnZXMsXG4gICAgZW5mb3JjZUFwcEluc3RhbGwsXG4gIH0gPSBvcHRzO1xuXG4gIGlmICghYXBwIHx8ICFhcHBQYWNrYWdlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiJ2FwcCcgYW5kICdhcHBQYWNrYWdlJyBvcHRpb25zIGFyZSByZXF1aXJlZFwiKTtcbiAgfVxuXG4gIGlmIChmdWxsUmVzZXQpIHtcbiAgICBhd2FpdCB0aGlzLnJlc2V0QXBwKGFkYiwgb3B0cyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qge1xuICAgIGFwcFN0YXRlLFxuICAgIHdhc1VuaW5zdGFsbGVkXG4gIH0gPSBhd2FpdCBhZGIuaW5zdGFsbE9yVXBncmFkZShhcHAsIGFwcFBhY2thZ2UsIHtcbiAgICBncmFudFBlcm1pc3Npb25zOiBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICB0aW1lb3V0OiBhbmRyb2lkSW5zdGFsbFRpbWVvdXQsXG4gICAgYWxsb3dUZXN0UGFja2FnZXMsXG4gICAgZW5mb3JjZUN1cnJlbnRCdWlsZDogZW5mb3JjZUFwcEluc3RhbGwsXG4gIH0pO1xuXG4gIC8vIFRoZXJlIGlzIG5vIG5lZWQgdG8gcmVzZXQgdGhlIG5ld2x5IGluc3RhbGxlZCBhcHBcbiAgY29uc3QgaXNJbnN0YWxsZWRPdmVyRXhpc3RpbmdBcHAgPSAhd2FzVW5pbnN0YWxsZWRcbiAgICAmJiBhcHBTdGF0ZSAhPT0gYWRiLkFQUF9JTlNUQUxMX1NUQVRFLk5PVF9JTlNUQUxMRUQ7XG4gIGlmIChmYXN0UmVzZXQgJiYgaXNJbnN0YWxsZWRPdmVyRXhpc3RpbmdBcHApIHtcbiAgICBsb2dnZXIuaW5mbyhgUGVyZm9ybWluZyBmYXN0IHJlc2V0IG9uICcke2FwcFBhY2thZ2V9J2ApO1xuICAgIGF3YWl0IHRoaXMucmVzZXRBcHAoYWRiLCBvcHRzKTtcbiAgfVxufTtcblxuLyoqXG4gKiBJbnN0YWxscyBhbiBhcnJheSBvZiBhcGtzXG4gKiBAcGFyYW0ge0FEQn0gYWRiIEluc3RhbmNlIG9mIEFwcGl1bSBBREIgb2JqZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyBPcHRzIGRlZmluZWQgaW4gZHJpdmVyLmpzXG4gKi9cbmhlbHBlcnMuaW5zdGFsbE90aGVyQXBrcyA9IGFzeW5jIGZ1bmN0aW9uIGluc3RhbGxPdGhlckFwa3MgKG90aGVyQXBwcywgYWRiLCBvcHRzKSB7XG4gIGxldCB7XG4gICAgYW5kcm9pZEluc3RhbGxUaW1lb3V0ID0gUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQsXG4gICAgYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgYWxsb3dUZXN0UGFja2FnZXNcbiAgfSA9IG9wdHM7XG5cbiAgLy8gSW5zdGFsbCBhbGwgb2YgdGhlIEFQSydzIGFzeW5jaHJvbm91c2x5XG4gIGF3YWl0IEIuYWxsKG90aGVyQXBwcy5tYXAoKG90aGVyQXBwKSA9PiB7XG4gICAgbG9nZ2VyLmRlYnVnKGBJbnN0YWxsaW5nIGFwcDogJHtvdGhlckFwcH1gKTtcbiAgICByZXR1cm4gYWRiLmluc3RhbGxPclVwZ3JhZGUob3RoZXJBcHAsIG51bGwsIHtcbiAgICAgIGdyYW50UGVybWlzc2lvbnM6IGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgICAgYWxsb3dUZXN0UGFja2FnZXMsXG4gICAgfSk7XG4gIH0pKTtcbn07XG5cbi8qKlxuICogVW5pbnN0YWxsIGFuIGFycmF5IG9mIHBhY2thZ2VzXG4gKiBAcGFyYW0ge0FEQn0gYWRiIEluc3RhbmNlIG9mIEFwcGl1bSBBREIgb2JqZWN0XG4gKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IGFwcFBhY2thZ2VzIEFuIGFycmF5IG9mIHBhY2thZ2UgbmFtZXMgdG8gdW5pbnN0YWxsLiBJZiB0aGlzIGluY2x1ZGVzIGAnKidgLCB1bmluc3RhbGwgYWxsIG9mIDNyZCBwYXJ0eSBhcHBzXG4gKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IGZpbHRlclBhY2thZ2VzIEFuIGFycmF5IG9mIHBhY2thZ2VzIGRvZXMgbm90IHVuaW5zdGFsbCB3aGVuIGAqYCBpcyBwcm92aWRlZCBhcyBgYXBwUGFja2FnZXNgXG4gKi9cbmhlbHBlcnMudW5pbnN0YWxsT3RoZXJQYWNrYWdlcyA9IGFzeW5jIGZ1bmN0aW9uIHVuaW5zdGFsbE90aGVyUGFja2FnZXMgKGFkYiwgYXBwUGFja2FnZXMsIGZpbHRlclBhY2thZ2VzID0gW10pIHtcbiAgaWYgKGFwcFBhY2thZ2VzLmluY2x1ZGVzKCcqJykpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1VuaW5zdGFsbCB0aGlyZCBwYXJ0eSBwYWNrYWdlcycpO1xuICAgIGFwcFBhY2thZ2VzID0gYXdhaXQgdGhpcy5nZXRUaGlyZFBhcnR5UGFja2FnZXMoYWRiLCBmaWx0ZXJQYWNrYWdlcyk7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoYFVuaW5zdGFsbGluZyBwYWNrYWdlczogJHthcHBQYWNrYWdlc31gKTtcbiAgYXdhaXQgQi5hbGwoYXBwUGFja2FnZXMubWFwKChhcHBQYWNrYWdlKSA9PiBhZGIudW5pbnN0YWxsQXBrKGFwcFBhY2thZ2UpKSk7XG59O1xuXG4vKipcbiAqIEdldCB0aGlyZCBwYXJ0eSBwYWNrYWdlcyBmaWx0ZXJlZCB3aXRoIGBmaWx0ZXJQYWNrYWdlc2BcbiAqIEBwYXJhbSB7QURCfSBhZGIgSW5zdGFuY2Ugb2YgQXBwaXVtIEFEQiBvYmplY3RcbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gZmlsdGVyUGFja2FnZXMgQW4gYXJyYXkgb2YgcGFja2FnZXMgZG9lcyBub3QgdW5pbnN0YWxsIHdoZW4gYCpgIGlzIHByb3ZpZGVkIGFzIGBhcHBQYWNrYWdlc2BcbiAqIEByZXR1cm5zIHtBcnJheTxzdHJpbmc+fSBBbiBhcnJheSBvZiBpbnN0YWxsZWQgdGhpcmQgcGFyeSBwYWNrYWdlc1xuICovXG5oZWxwZXJzLmdldFRoaXJkUGFydHlQYWNrYWdlcyA9IGFzeW5jIGZ1bmN0aW9uIGdldFRoaXJkUGFydHlQYWNrYWdlcyAoYWRiLCBmaWx0ZXJQYWNrYWdlcyA9IFtdKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFja2FnZXNTdHJpbmcgPSBhd2FpdCBhZGIuc2hlbGwoWydwbScsICdsaXN0JywgJ3BhY2thZ2VzJywgJy0zJ10pO1xuICAgIGNvbnN0IGFwcFBhY2thZ2VzQXJyYXkgPSBwYWNrYWdlc1N0cmluZy50cmltKCkucmVwbGFjZSgvcGFja2FnZTovZywgJycpLnNwbGl0KEVPTCk7XG4gICAgbG9nZ2VyLmRlYnVnKGAnJHthcHBQYWNrYWdlc0FycmF5fScgZmlsdGVyZWQgd2l0aCAnJHtmaWx0ZXJQYWNrYWdlc30nYCk7XG4gICAgcmV0dXJuIF8uZGlmZmVyZW5jZShhcHBQYWNrYWdlc0FycmF5LCBmaWx0ZXJQYWNrYWdlcyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci53YXJuKGBVbmFibGUgdG8gZ2V0IHBhY2thZ2VzIHdpdGggJ2FkYiBzaGVsbCBwbSBsaXN0IHBhY2thZ2VzIC0zJzogJHtlcnIubWVzc2FnZX1gKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn07XG5cbmhlbHBlcnMuaW5pdFVuaWNvZGVLZXlib2FyZCA9IGFzeW5jIGZ1bmN0aW9uIGluaXRVbmljb2RlS2V5Ym9hcmQgKGFkYikge1xuICBsb2dnZXIuZGVidWcoJ0VuYWJsaW5nIFVuaWNvZGUga2V5Ym9hcmQgc3VwcG9ydCcpO1xuXG4gIC8vIGdldCB0aGUgZGVmYXVsdCBJTUUgc28gd2UgY2FuIHJldHVybiBiYWNrIHRvIGl0IGxhdGVyIGlmIHdlIHdhbnRcbiAgbGV0IGRlZmF1bHRJTUUgPSBhd2FpdCBhZGIuZGVmYXVsdElNRSgpO1xuXG4gIGxvZ2dlci5kZWJ1ZyhgVW5zZXR0aW5nIHByZXZpb3VzIElNRSAke2RlZmF1bHRJTUV9YCk7XG4gIGNvbnN0IGFwcGl1bUlNRSA9IGAke1NFVFRJTkdTX0hFTFBFUl9QS0dfSUR9Ly5Vbmljb2RlSU1FYDtcbiAgbG9nZ2VyLmRlYnVnKGBTZXR0aW5nIElNRSB0byAnJHthcHBpdW1JTUV9J2ApO1xuICBhd2FpdCBhZGIuZW5hYmxlSU1FKGFwcGl1bUlNRSk7XG4gIGF3YWl0IGFkYi5zZXRJTUUoYXBwaXVtSU1FKTtcbiAgcmV0dXJuIGRlZmF1bHRJTUU7XG59O1xuXG5oZWxwZXJzLnNldE1vY2tMb2NhdGlvbkFwcCA9IGFzeW5jIGZ1bmN0aW9uIHNldE1vY2tMb2NhdGlvbkFwcCAoYWRiLCBhcHApIHtcbiAgdHJ5IHtcbiAgICBpZiAoYXdhaXQgYWRiLmdldEFwaUxldmVsKCkgPCAyMykge1xuICAgICAgYXdhaXQgYWRiLnNoZWxsKFsnc2V0dGluZ3MnLCAncHV0JywgJ3NlY3VyZScsICdtb2NrX2xvY2F0aW9uJywgJzEnXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGFkYi5zaGVsbChbJ2FwcG9wcycsICdzZXQnLCBhcHAsICdhbmRyb2lkOm1vY2tfbG9jYXRpb24nLCAnYWxsb3cnXSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgVW5hYmxlIHRvIHNldCBtb2NrIGxvY2F0aW9uIGZvciBhcHAgJyR7YXBwfSc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuaW5zdGFsbEhlbHBlckFwcCA9IGFzeW5jIGZ1bmN0aW9uIGluc3RhbGxIZWxwZXJBcHAgKGFkYiwgYXBrUGF0aCwgcGFja2FnZUlkKSB7XG4gIC8vIFNvbWV0aW1lcyBhZGIgcHVzaCBvciBhZGIgaW5zdGFsIHRha2UgbW9yZSB0aW1lIHRoYW4gZXhwZWN0ZWQgdG8gaW5zdGFsbCBhbiBhcHBcbiAgLy8gZS5nLiBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2lvLmFwcGl1bS5zZXR0aW5ncy9pc3N1ZXMvNDAjaXNzdWVjb21tZW50LTQ3NjU5MzE3NFxuICBhd2FpdCByZXRyeSgyLCBhc3luYyBmdW5jdGlvbiByZXRyeUluc3RhbGxIZWxwZXJBcHAgKCkge1xuICAgIGF3YWl0IGFkYi5pbnN0YWxsT3JVcGdyYWRlKGFwa1BhdGgsIHBhY2thZ2VJZCwge2dyYW50UGVybWlzc2lvbnM6IHRydWV9KTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIFB1c2hlcyBhbmQgaW5zdGFsbHMgaW8uYXBwaXVtLnNldHRpbmdzIGFwcC5cbiAqIFRocm93cyBhbiBlcnJvciBpZiB0aGUgc2V0dGluZyBhcHAgaXMgcmVxdWlyZWRcbiAqXG4gKiBAcGFyYW0ge0FkYn0gYWRiIC0gVGhlIGFkYiBtb2R1bGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHRocm93RXJyb3JbZmFsc2VdIC0gV2hldGhlciB0aHJvdyBlcnJvciBvciBub3RcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aHJvd0Vycm9yIGlzIHRydWUgYW5kIHNvbWV0aGluZyBoYXBwZW5zIGluIGluc3RhbGxhdGlvbiBzdGVwXG4gKi9cbmhlbHBlcnMucHVzaFNldHRpbmdzQXBwID0gYXN5bmMgZnVuY3Rpb24gcHVzaFNldHRpbmdzQXBwIChhZGIsIHRocm93RXJyb3IgPSBmYWxzZSkge1xuICBsb2dnZXIuZGVidWcoJ1B1c2hpbmcgc2V0dGluZ3MgYXBrIHRvIGRldmljZS4uLicpO1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgaGVscGVycy5pbnN0YWxsSGVscGVyQXBwKGFkYiwgc2V0dGluZ3NBcGtQYXRoLCBTRVRUSU5HU19IRUxQRVJfUEtHX0lELCB0aHJvd0Vycm9yKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKHRocm93RXJyb3IpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG5cbiAgICBsb2dnZXIud2FybihgSWdub3JlZCBlcnJvciB3aGlsZSBpbnN0YWxsaW5nICcke3NldHRpbmdzQXBrUGF0aH0nOiBgICtcbiAgICAgICAgICAgICAgICBgJyR7ZXJyLm1lc3NhZ2V9Jy4gRmVhdHVyZXMgdGhhdCByZWx5IG9uIHRoaXMgaGVscGVyIGAgK1xuICAgICAgICAgICAgICAgICdyZXF1aXJlIHRoZSBhcGsgc3VjaCBhcyB0b2dnbGUgV2lGaSBhbmQgZ2V0dGluZyBsb2NhdGlvbiAnICtcbiAgICAgICAgICAgICAgICAnd2lsbCByYWlzZSBhbiBlcnJvciBpZiB5b3UgdHJ5IHRvIHVzZSB0aGVtLicpO1xuICB9XG5cbiAgLy8gUmVpbnN0YWxsIHdpbGwgc3RvcCB0aGUgc2V0dGluZ3MgaGVscGVyIHByb2Nlc3MgYW55d2F5LCBzb1xuICAvLyB0aGVyZSBpcyBubyBuZWVkIHRvIGNvbnRpbnVlIGlmIHRoZSBhcHBsaWNhdGlvbiBpcyBzdGlsbCBydW5uaW5nXG4gIGlmIChhd2FpdCBhZGIucHJvY2Vzc0V4aXN0cyhTRVRUSU5HU19IRUxQRVJfUEtHX0lEKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfSBpcyBhbHJlYWR5IHJ1bm5pbmcuIGAgK1xuICAgICAgYFRoZXJlIGlzIG5vIG5lZWQgdG8gcmVzZXQgaXRzIHBlcm1pc3Npb25zLmApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChhd2FpdCBhZGIuZ2V0QXBpTGV2ZWwoKSA8PSAyMykgeyAvLyBBbmRyb2lkIDYtIGRldmljZXMgc2hvdWxkIGhhdmUgZ3JhbnRlZCBwZXJtaXNzaW9uc1xuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL3B1bGwvMTE2NDAjaXNzdWVjb21tZW50LTQzODI2MDQ3N1xuICAgIGNvbnN0IHBlcm1zID0gWydTRVRfQU5JTUFUSU9OX1NDQUxFJywgJ0NIQU5HRV9DT05GSUdVUkFUSU9OJywgJ0FDQ0VTU19GSU5FX0xPQ0FUSU9OJ107XG4gICAgbG9nZ2VyLmluZm8oYEdyYW50aW5nIHBlcm1pc3Npb25zICR7cGVybXN9IHRvICcke1NFVFRJTkdTX0hFTFBFUl9QS0dfSUR9J2ApO1xuICAgIGF3YWl0IGFkYi5ncmFudFBlcm1pc3Npb25zKFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQsIHBlcm1zLm1hcCgoeCkgPT4gYGFuZHJvaWQucGVybWlzc2lvbi4ke3h9YCkpO1xuICB9XG5cbiAgLy8gbGF1bmNoIGlvLmFwcGl1bS5zZXR0aW5ncyBhcHAgZHVlIHRvIHNldHRpbmdzIGZhaWxpbmcgdG8gYmUgc2V0XG4gIC8vIGlmIHRoZSBhcHAgaXMgbm90IGxhdW5jaGVkIHByaW9yIHRvIHN0YXJ0IHRoZSBzZXNzaW9uIG9uIGFuZHJvaWQgNytcbiAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy84OTU3XG4gIHRyeSB7XG4gICAgYXdhaXQgYWRiLnJlcXVpcmVSdW5uaW5nU2V0dGluZ3NBcHAoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGVycik7XG4gICAgaWYgKHRocm93RXJyb3IpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogRXh0cmFjdHMgc3RyaW5nLnhtbCBhbmQgY29udmVydHMgaXQgdG8gc3RyaW5nLmpzb24gYW5kIHB1c2hlc1xuICogaXQgdG8gL2RhdGEvbG9jYWwvdG1wL3N0cmluZy5qc29uIG9uIGZvciB1c2Ugb2YgYm9vdHN0cmFwXG4gKiBJZiBhcHAgaXMgbm90IHByZXNlbnQgdG8gZXh0cmFjdCBzdHJpbmcueG1sIGl0IGRlbGV0ZXMgcmVtb3RlIHN0cmluZ3MuanNvblxuICogSWYgYXBwIGRvZXMgbm90IGhhdmUgc3RyaW5ncy54bWwgd2UgcHVzaCBhbiBlbXB0eSBqc29uIG9iamVjdCB0byByZW1vdGVcbiAqXG4gKiBAcGFyYW0gez9zdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UgYWJicmV2aWF0aW9uLCBmb3IgZXhhbXBsZSAnZnInLiBUaGUgZGVmYXVsdCBsYW5ndWFnZVxuICogaXMgdXNlZCBpZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBkZWZpbmVkLlxuICogQHBhcmFtIHtPYmplY3R9IGFkYiAtIFRoZSBhZGIgbW9kdWxlIGluc3RhbmNlLlxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgLSBEcml2ZXIgb3B0aW9ucyBkaWN0aW9uYXJ5LlxuICogQHJldHVybnMge09iamVjdH0gVGhlIGRpY3Rpb25hcnksIHdoZXJlIHN0cmluZyByZXNvdXJjZSBpZGVudGlmaWVycyBhcmUga2V5c1xuICogYWxvbmcgd2l0aCB0aGVpciBjb3JyZXNwb25kaW5nIHZhbHVlcyBmb3IgdGhlIGdpdmVuIGxhbmd1YWdlIG9yIGFuIGVtcHR5IG9iamVjdFxuICogaWYgbm8gbWF0Y2hpbmcgcmVzb3VyY2VzIHdlcmUgZXh0cmFjdGVkLlxuICovXG5oZWxwZXJzLnB1c2hTdHJpbmdzID0gYXN5bmMgZnVuY3Rpb24gcHVzaFN0cmluZ3MgKGxhbmd1YWdlLCBhZGIsIG9wdHMpIHtcbiAgY29uc3QgcmVtb3RlRGlyID0gJy9kYXRhL2xvY2FsL3RtcCc7XG4gIGNvbnN0IHN0cmluZ3NKc29uID0gJ3N0cmluZ3MuanNvbic7XG4gIGNvbnN0IHJlbW90ZUZpbGUgPSBwYXRoLnBvc2l4LnJlc29sdmUocmVtb3RlRGlyLCBzdHJpbmdzSnNvbik7XG5cbiAgLy8gY2xlYW4gdXAgcmVtb3RlIHN0cmluZy5qc29uIGlmIHByZXNlbnRcbiAgYXdhaXQgYWRiLnJpbXJhZihyZW1vdGVGaWxlKTtcblxuICBsZXQgYXBwO1xuICB0cnkge1xuICAgIGFwcCA9IG9wdHMuYXBwIHx8IGF3YWl0IGFkYi5wdWxsQXBrKG9wdHMuYXBwUGFja2FnZSwgb3B0cy50bXBEaXIpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIuaW5mbyhgRmFpbGVkIHRvIHB1bGwgYW4gYXBrIGZyb20gJyR7b3B0cy5hcHBQYWNrYWdlfScgdG8gJyR7b3B0cy50bXBEaXJ9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cblxuICBpZiAoXy5pc0VtcHR5KG9wdHMuYXBwUGFja2FnZSkgfHwgIShhd2FpdCBmcy5leGlzdHMoYXBwKSkpIHtcbiAgICBsb2dnZXIuZGVidWcoYE5vIGFwcCBvciBwYWNrYWdlIHNwZWNpZmllZC4gUmV0dXJuaW5nIGVtcHR5IHN0cmluZ3NgKTtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCBzdHJpbmdzVG1wRGlyID0gcGF0aC5yZXNvbHZlKG9wdHMudG1wRGlyLCBvcHRzLmFwcFBhY2thZ2UpO1xuICB0cnkge1xuICAgIGxvZ2dlci5kZWJ1ZygnRXh0cmFjdGluZyBzdHJpbmdzIGZyb20gYXBrJywgYXBwLCBsYW5ndWFnZSwgc3RyaW5nc1RtcERpcik7XG4gICAgY29uc3Qge2Fwa1N0cmluZ3MsIGxvY2FsUGF0aH0gPSBhd2FpdCBhZGIuZXh0cmFjdFN0cmluZ3NGcm9tQXBrKGFwcCwgbGFuZ3VhZ2UsIHN0cmluZ3NUbXBEaXIpO1xuICAgIGF3YWl0IGFkYi5wdXNoKGxvY2FsUGF0aCwgcmVtb3RlRGlyKTtcbiAgICByZXR1cm4gYXBrU3RyaW5ncztcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLndhcm4oYENvdWxkIG5vdCBnZXQgc3RyaW5ncywgY29udGludWluZyBhbnl3YXkuIE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIGF3YWl0IGFkYi5zaGVsbCgnZWNobycsIFtgJ3t9JyA+ICR7cmVtb3RlRmlsZX1gXSk7XG4gIH0gZmluYWxseSB7XG4gICAgYXdhaXQgZnMucmltcmFmKHN0cmluZ3NUbXBEaXIpO1xuICB9XG4gIHJldHVybiB7fTtcbn07XG5cbmhlbHBlcnMudW5sb2NrV2l0aFVJQXV0b21hdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIHVubG9ja1dpdGhVSUF1dG9tYXRpb24gKGRyaXZlciwgYWRiLCB1bmxvY2tDYXBhYmlsaXRpZXMpIHtcbiAgbGV0IHVubG9ja1R5cGUgPSB1bmxvY2tDYXBhYmlsaXRpZXMudW5sb2NrVHlwZTtcbiAgaWYgKCF1bmxvY2tlci5pc1ZhbGlkVW5sb2NrVHlwZSh1bmxvY2tUeXBlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCB1bmxvY2sgdHlwZSAke3VubG9ja1R5cGV9YCk7XG4gIH1cbiAgbGV0IHVubG9ja0tleSA9IHVubG9ja0NhcGFiaWxpdGllcy51bmxvY2tLZXk7XG4gIGlmICghdW5sb2NrZXIuaXNWYWxpZEtleSh1bmxvY2tUeXBlLCB1bmxvY2tLZXkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIHVubG9ja0tleSAke3VubG9ja0tleX0gY2FwYWJpbGl0eSBmb3IgdW5sb2NrVHlwZSAke3VubG9ja1R5cGV9YCk7XG4gIH1cbiAgY29uc3QgdW5sb2NrTWV0aG9kID0ge1xuICAgIFtQSU5fVU5MT0NLXTogdW5sb2NrZXIucGluVW5sb2NrLFxuICAgIFtQQVNTV09SRF9VTkxPQ0tdOiB1bmxvY2tlci5wYXNzd29yZFVubG9jayxcbiAgICBbUEFUVEVSTl9VTkxPQ0tdOiB1bmxvY2tlci5wYXR0ZXJuVW5sb2NrLFxuICAgIFtGSU5HRVJQUklOVF9VTkxPQ0tdOiB1bmxvY2tlci5maW5nZXJwcmludFVubG9ja1xuICB9W3VubG9ja1R5cGVdO1xuICBhd2FpdCB1bmxvY2tNZXRob2QoYWRiLCBkcml2ZXIsIHVubG9ja0NhcGFiaWxpdGllcyk7XG59O1xuXG5oZWxwZXJzLnVubG9ja1dpdGhIZWxwZXJBcHAgPSBhc3luYyBmdW5jdGlvbiB1bmxvY2tXaXRoSGVscGVyQXBwIChhZGIpIHtcbiAgbG9nZ2VyLmluZm8oJ1VubG9ja2luZyBzY3JlZW4nKTtcblxuICAvLyBVbmxvY2sgc3VjY2VlZCB3aXRoIGEgY291cGxlIG9mIHJldHJpZXMuXG4gIGxldCBmaXJzdFJ1biA9IHRydWU7XG4gIGF3YWl0IHJldHJ5KDMsIGFzeW5jIGZ1bmN0aW9uIGxhdW5jaEhlbHBlciAoKSB7XG4gICAgLy8gVG8gcmVkdWNlIGEgdGltZSB0byBjYWxsIGFkYi5pc1NjcmVlbkxvY2tlZCgpIHNpbmNlIGBhZGIgc2hlbGwgZHVtcHN5cyB3aW5kb3dgIGlzIGVhc3kgdG8gaGFuZyBhZGIgY29tbWFuZHNcbiAgICBpZiAoZmlyc3RSdW4pIHtcbiAgICAgIGZpcnN0UnVuID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghKGF3YWl0IGFkYi5pc1NjcmVlbkxvY2tlZCgpKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2dnZXIud2FybihgRXJyb3IgaW4gaXNTY3JlZW5Mb2NrZWQ6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICBsb2dnZXIud2FybignXCJhZGIgc2hlbGwgZHVtcHN5cyB3aW5kb3dcIiBjb21tYW5kIGhhcyB0aW1lZCBvdXQuJyk7XG4gICAgICAgIGxvZ2dlci53YXJuKCdUaGUgcmVhc29uIG9mIHRoaXMgdGltZW91dCBpcyB0aGUgZGVsYXllZCBhZGIgcmVzcG9uc2UuIFJlc2V0dGluZyBhZGIgc2VydmVyIGNhbiBpbXByb3ZlIGl0LicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxvZ2dlci5pbmZvKGBMYXVuY2hpbmcgJHtTRVRUSU5HU19IRUxQRVJfVU5MT0NLX0FDVElWSVRZfWApO1xuICAgIGF3YWl0IGFkYi5zaGVsbChbXG4gICAgICAnYW0nLCAnc3RhcnQnLFxuICAgICAgJy1uJywgYCR7U0VUVElOR1NfSEVMUEVSX1BLR19JRH0vJHtTRVRUSU5HU19IRUxQRVJfVU5MT0NLX0FDVElWSVRZfWAsXG4gICAgICAnLWMnLCAnYW5kcm9pZC5pbnRlbnQuY2F0ZWdvcnkuTEFVTkNIRVInLFxuICAgICAgJy1hJywgJ2FuZHJvaWQuaW50ZW50LmFjdGlvbi5NQUlOJyxcbiAgICAgICctZicsICcweDEwMjAwMDAwJyxcbiAgICBdKTtcbiAgICBhd2FpdCBCLmRlbGF5KDEwMDApO1xuICB9KTtcbn07XG5cbmhlbHBlcnMudW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gdW5sb2NrIChkcml2ZXIsIGFkYiwgY2FwYWJpbGl0aWVzKSB7XG4gIGlmICghKGF3YWl0IGFkYi5pc1NjcmVlbkxvY2tlZCgpKSkge1xuICAgIGxvZ2dlci5pbmZvKCdTY3JlZW4gYWxyZWFkeSB1bmxvY2tlZCwgZG9pbmcgbm90aGluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZygnU2NyZWVuIGlzIGxvY2tlZCwgdHJ5aW5nIHRvIHVubG9jaycpO1xuICBpZiAoXy5pc1VuZGVmaW5lZChjYXBhYmlsaXRpZXMudW5sb2NrVHlwZSkpIHtcbiAgICBsb2dnZXIud2FybignVXNpbmcgYXBwIHVubG9jaywgdGhpcyBpcyBnb2luZyB0byBiZSBkZXByZWNhdGVkIScpO1xuICAgIGF3YWl0IGhlbHBlcnMudW5sb2NrV2l0aEhlbHBlckFwcChhZGIpO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IGhlbHBlcnMudW5sb2NrV2l0aFVJQXV0b21hdGlvbihkcml2ZXIsIGFkYiwge3VubG9ja1R5cGU6IGNhcGFiaWxpdGllcy51bmxvY2tUeXBlLCB1bmxvY2tLZXk6IGNhcGFiaWxpdGllcy51bmxvY2tLZXl9KTtcbiAgICBhd2FpdCBoZWxwZXJzLnZlcmlmeVVubG9jayhhZGIsIGNhcGFiaWxpdGllcy51bmxvY2tTdWNjZXNzVGltZW91dCk7XG4gIH1cbn07XG5cbmhlbHBlcnMudmVyaWZ5VW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gdmVyaWZ5VW5sb2NrIChhZGIsIHVubG9ja1N1Y2Nlc3NUaW1lb3V0KSB7XG4gIGxldCBzdWNjZXNzVGltZW91dCA9IHVubG9ja1N1Y2Nlc3NUaW1lb3V0IHx8IDIwMDA7XG4gIGF3YWl0IHJldHJ5SW50ZXJ2YWwoc3VjY2Vzc1RpbWVvdXQgLyAxMDAwLCBzdWNjZXNzVGltZW91dCwgYXN5bmMgKCkgPT4ge1xuICAgIGlmIChhd2FpdCBhZGIuaXNTY3JlZW5Mb2NrZWQoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTY3JlZW4gZGlkIG5vdCB1bmxvY2sgc3VjY2Vzc2Z1bGx5LCByZXRyeWluZycpO1xuICAgIH1cbiAgICBsb2dnZXIuZGVidWcoJ1NjcmVlbiB1bmxvY2tlZCBzdWNjZXNzZnVsbHknKTtcbiAgfSk7XG59O1xuXG5oZWxwZXJzLmluaXREZXZpY2UgPSBhc3luYyBmdW5jdGlvbiBpbml0RGV2aWNlIChhZGIsIG9wdHMpIHtcbiAgY29uc3Qge1xuICAgIHNraXBEZXZpY2VJbml0aWFsaXphdGlvbixcbiAgICBsb2NhbGUsXG4gICAgbGFuZ3VhZ2UsXG4gICAgbG9jYWxlU2NyaXB0LFxuICAgIHVuaWNvZGVLZXlib2FyZCxcbiAgICBkaXNhYmxlV2luZG93QW5pbWF0aW9uLFxuICAgIHNraXBVbmxvY2ssXG4gICAgbW9ja0xvY2F0aW9uQXBwLFxuICAgIHNraXBMb2djYXRDYXB0dXJlLFxuICAgIGxvZ2NhdEZvcm1hdCxcbiAgICBsb2djYXRGaWx0ZXJTcGVjcyxcbiAgfSA9IG9wdHM7XG5cbiAgaWYgKHNraXBEZXZpY2VJbml0aWFsaXphdGlvbikge1xuICAgIGxvZ2dlci5pbmZvKGAnc2tpcERldmljZUluaXRpYWxpemF0aW9uJyBpcyBzZXQuIFNraXBwaW5nIGRldmljZSBpbml0aWFsaXphdGlvbi5gKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBhZGIud2FpdEZvckRldmljZSgpO1xuICAgIC8vIHB1c2hTZXR0aW5nc0FwcCByZXF1aXJlZCBiZWZvcmUgY2FsbGluZyBlbnN1cmVEZXZpY2VMb2NhbGUgZm9yIEFQSSBMZXZlbCAyNCtcblxuICAgIC8vIFNvbWUgZmVhdHVyZSBzdWNoIGFzIGxvY2F0aW9uL3dpZmkgYXJlIG5vdCBuZWNlc3NhcnkgZm9yIGFsbCB1c2VycyxcbiAgICAvLyBidXQgdGhleSByZXF1aXJlIHRoZSBzZXR0aW5ncyBhcHAuIFNvLCB0cnkgdG8gY29uZmlndXJlIGl0IHdoaWxlIEFwcGl1bVxuICAgIC8vIGRvZXMgbm90IHRocm93IGVycm9yIGV2ZW4gaWYgdGhleSBmYWlsLlxuICAgIGNvbnN0IHNob3VsZFRocm93RXJyb3IgPSBsYW5ndWFnZVxuICAgICAgfHwgbG9jYWxlXG4gICAgICB8fCBsb2NhbGVTY3JpcHRcbiAgICAgIHx8IHVuaWNvZGVLZXlib2FyZFxuICAgICAgfHwgZGlzYWJsZVdpbmRvd0FuaW1hdGlvblxuICAgICAgfHwgIXNraXBVbmxvY2s7XG4gICAgYXdhaXQgaGVscGVycy5wdXNoU2V0dGluZ3NBcHAoYWRiLCBzaG91bGRUaHJvd0Vycm9yKTtcbiAgfVxuXG4gIGlmICghaGVscGVycy5pc0VtdWxhdG9yKGFkYiwgb3B0cykgJiYgKG1vY2tMb2NhdGlvbkFwcCB8fCBfLmlzVW5kZWZpbmVkKG1vY2tMb2NhdGlvbkFwcCkpKSB7XG4gICAgYXdhaXQgaGVscGVycy5zZXRNb2NrTG9jYXRpb25BcHAoYWRiLCBtb2NrTG9jYXRpb25BcHAgfHwgU0VUVElOR1NfSEVMUEVSX1BLR19JRCk7XG4gIH1cblxuICBpZiAobGFuZ3VhZ2UgfHwgbG9jYWxlKSB7XG4gICAgYXdhaXQgaGVscGVycy5lbnN1cmVEZXZpY2VMb2NhbGUoYWRiLCBsYW5ndWFnZSwgbG9jYWxlLCBsb2NhbGVTY3JpcHQpO1xuICB9XG5cbiAgaWYgKHNraXBMb2djYXRDYXB0dXJlKSB7XG4gICAgbG9nZ2VyLmluZm8oYCdza2lwTG9nY2F0Q2FwdHVyZScgaXMgc2V0LiBTa2lwcGluZyBzdGFydGluZyBsb2djYXQgY2FwdHVyZS5gKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBhZGIuc3RhcnRMb2djYXQoe1xuICAgICAgZm9ybWF0OiBsb2djYXRGb3JtYXQsXG4gICAgICBmaWx0ZXJTcGVjczogbG9nY2F0RmlsdGVyU3BlY3MsXG4gICAgfSk7XG4gIH1cblxuICBpZiAodW5pY29kZUtleWJvYXJkKSB7XG4gICAgcmV0dXJuIGF3YWl0IGhlbHBlcnMuaW5pdFVuaWNvZGVLZXlib2FyZChhZGIpO1xuICB9XG59O1xuXG5oZWxwZXJzLnJlbW92ZU51bGxQcm9wZXJ0aWVzID0gZnVuY3Rpb24gcmVtb3ZlTnVsbFByb3BlcnRpZXMgKG9iaikge1xuICBmb3IgKGxldCBrZXkgb2YgXy5rZXlzKG9iaikpIHtcbiAgICBpZiAoXy5pc051bGwob2JqW2tleV0pIHx8IF8uaXNVbmRlZmluZWQob2JqW2tleV0pKSB7XG4gICAgICBkZWxldGUgb2JqW2tleV07XG4gICAgfVxuICB9XG59O1xuXG5oZWxwZXJzLnRydW5jYXRlRGVjaW1hbHMgPSBmdW5jdGlvbiB0cnVuY2F0ZURlY2ltYWxzIChudW1iZXIsIGRpZ2l0cykge1xuICBsZXQgbXVsdGlwbGllciA9IE1hdGgucG93KDEwLCBkaWdpdHMpLFxuICAgICAgYWRqdXN0ZWROdW0gPSBudW1iZXIgKiBtdWx0aXBsaWVyLFxuICAgICAgdHJ1bmNhdGVkTnVtID0gTWF0aFthZGp1c3RlZE51bSA8IDAgPyAnY2VpbCcgOiAnZmxvb3InXShhZGp1c3RlZE51bSk7XG5cbiAgcmV0dXJuIHRydW5jYXRlZE51bSAvIG11bHRpcGxpZXI7XG59O1xuXG5oZWxwZXJzLmlzQ2hyb21lQnJvd3NlciA9IGZ1bmN0aW9uIGlzQ2hyb21lQnJvd3NlciAoYnJvd3Nlcikge1xuICByZXR1cm4gXy5pbmNsdWRlcyhPYmplY3Qua2V5cyhDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZKSwgKGJyb3dzZXIgfHwgJycpLnRvTG93ZXJDYXNlKCkpO1xufTtcblxuaGVscGVycy5nZXRDaHJvbWVQa2cgPSBmdW5jdGlvbiBnZXRDaHJvbWVQa2cgKGJyb3dzZXIpIHtcbiAgcmV0dXJuIENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFlbYnJvd3Nlci50b0xvd2VyQ2FzZSgpXSB8fCBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZLmRlZmF1bHQ7XG59O1xuXG5oZWxwZXJzLnJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyA9IGFzeW5jIGZ1bmN0aW9uIHJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyAoc2VydmVyLCBzZXNzaW9uSWQpIHtcbiAgaWYgKCFzZXJ2ZXIgfHwgIV8uaXNGdW5jdGlvbihzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlSGFuZGxlcnMgPSBhd2FpdCBzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMoc2Vzc2lvbklkKTtcbiAgZm9yIChjb25zdCBwYXRobmFtZSBvZiBfLmtleXMoYWN0aXZlSGFuZGxlcnMpKSB7XG4gICAgYXdhaXQgc2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIocGF0aG5hbWUpO1xuICB9XG59O1xuXG4vKipcbiAqIFRha2VzIGEgZGVzaXJlZCBjYXBhYmlsaXR5IGFuZCB0cmllcyB0byBKU09OLnBhcnNlIGl0IGFzIGFuIGFycmF5LFxuICogYW5kIGVpdGhlciByZXR1cm5zIHRoZSBwYXJzZWQgYXJyYXkgb3IgYSBzaW5nbGV0b24gYXJyYXkuXG4gKlxuICogQHBhcmFtIHthbnl9IGNhcCBBIGRlc2lyZWQgY2FwYWJpbGl0eVxuICovXG5oZWxwZXJzLnBhcnNlQXJyYXkgPSBmdW5jdGlvbiBwYXJzZUFycmF5IChjYXApIHtcbiAgbGV0IHBhcnNlZENhcHM7XG4gIHRyeSB7XG4gICAgcGFyc2VkQ2FwcyA9IEpTT04ucGFyc2UoY2FwKTtcbiAgfSBjYXRjaCAoaWduKSB7IH1cblxuICBpZiAoXy5pc0FycmF5KHBhcnNlZENhcHMpKSB7XG4gICAgcmV0dXJuIHBhcnNlZENhcHM7XG4gIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhjYXApKSB7XG4gICAgcmV0dXJuIFtjYXBdO1xuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKGBtdXN0IHByb3ZpZGUgYSBzdHJpbmcgb3IgSlNPTiBBcnJheTsgcmVjZWl2ZWQgJHtjYXB9YCk7XG59O1xuXG4vKipcbiAqIFZhbGlkYXRlIGRlc2lyZWQgY2FwYWJpbGl0aWVzLiBSZXR1cm5zIHRydWUgaWYgY2FwYWJpbGl0eSBpcyB2YWxpZFxuICpcbiAqIEBwYXJhbSB7Kn0gY2FwIEEgZGVzaXJlZCBjYXBhYmlsaXR5XG4gKiBAcmV0dXJuIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgdGhlIGNhcGFiaWxpdHkgaXMgdmFsaWRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY2FwcyBoYXMgaW52YWxpZCBjYXBhYmlsaXR5XG4gKi9cbmhlbHBlcnMudmFsaWRhdGVEZXNpcmVkQ2FwcyA9IGZ1bmN0aW9uIHZhbGlkYXRlRGVzaXJlZENhcHMgKGNhcHMpIHtcbiAgaWYgKGNhcHMuYnJvd3Nlck5hbWUpIHtcbiAgICBpZiAoY2Fwcy5hcHApIHtcbiAgICAgIC8vIHdhcm4gaWYgdGhlIGNhcGFiaWxpdGllcyBoYXZlIGJvdGggYGFwcGAgYW5kIGBicm93c2VyLCBhbHRob3VnaCB0aGlzIGlzIGNvbW1vbiB3aXRoIHNlbGVuaXVtIGdyaWRcbiAgICAgIGxvZ2dlci53YXJuKGBUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgc2hvdWxkIGdlbmVyYWxseSBub3QgaW5jbHVkZSBib3RoIGFuICdhcHAnIGFuZCBhICdicm93c2VyTmFtZSdgKTtcbiAgICB9XG4gICAgaWYgKGNhcHMuYXBwUGFja2FnZSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFRoZSBkZXNpcmVkIHNob3VsZCBub3QgaW5jbHVkZSBib3RoIG9mIGFuICdhcHBQYWNrYWdlJyBhbmQgYSAnYnJvd3Nlck5hbWUnYCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGNhcHMudW5pbnN0YWxsT3RoZXJQYWNrYWdlcykge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnBhcnNlQXJyYXkoY2Fwcy51bmluc3RhbGxPdGhlclBhY2thZ2VzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IHBhcnNlIFwidW5pbnN0YWxsT3RoZXJQYWNrYWdlc1wiIGNhcGFiaWxpdHk6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyoqXG4gKiBBZGp1c3QgdGhlIGNhcGFiaWxpdGllcyBmb3IgYSBicm93c2VyIHNlc3Npb25cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gY2FwcyAtIEN1cnJlbnQgY2FwYWJpbGl0aWVzIG9iamVjdFxuICogISEhIFRoZSBvYmplY3QgaXMgbXV0YXRlZCBieSB0aGlzIG1ldGhvZCBjYWxsICEhIVxuICogQHJldHVybnMge09iamVjdH0gVGhlIHNhbWUgcG9zc2libHkgbXV0YXRlZCBgb3B0c2AgaW5zdGFuY2UuXG4gKiBObyBtdXRhdGlvbiBpcyBoYXBwZW5pbmcgaXMgdGhlIGN1cnJlbnQgc2Vzc2lvbiBpZlxuICogYXBwUGFja2FnZS9hcHBBY3Rpdml0eSBjYXBzIGhhdmUgYWxyZWFkeSBiZWVuIHByb3ZpZGVkLlxuICovXG5oZWxwZXJzLmFkanVzdEJyb3dzZXJTZXNzaW9uQ2FwcyA9IGZ1bmN0aW9uIGFkanVzdEJyb3dzZXJTZXNzaW9uQ2FwcyAoY2FwcyA9IHt9KSB7XG4gIGNvbnN0IHsgYnJvd3Nlck5hbWUgfSA9IGNhcHM7XG4gIGxvZ2dlci5pbmZvKGBUaGUgY3VycmVudCBzZXNzaW9uIGlzIGNvbnNpZGVyZWQgYnJvd3Nlci1iYXNlZGApO1xuICBsb2dnZXIuaW5mbyhgU3VwcG9ydGVkIGJyb3dzZXIgbmFtZXM6ICR7SlNPTi5zdHJpbmdpZnkoXy5rZXlzKENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFkpKX1gKTtcbiAgaWYgKGNhcHMuYXBwUGFja2FnZSB8fCBjYXBzLmFwcEFjdGl2aXR5KSB7XG4gICAgbG9nZ2VyLmluZm8oYE5vdCBvdmVycmlkaW5nIGFwcFBhY2thZ2UvYXBwQWN0aXZpdHkgY2FwYWJpbGl0eSB2YWx1ZXMgZm9yICcke2Jyb3dzZXJOYW1lfScgYCArXG4gICAgICAnYmVjYXVzZSBzb21lIG9mIHRoZW0gaGF2ZSBiZWVuIGFscmVhZHkgcHJvdmlkZWQnKTtcbiAgICByZXR1cm4gY2FwcztcbiAgfVxuXG4gIGNvbnN0IHtwa2csIGFjdGl2aXR5fSA9IHRoaXMuZ2V0Q2hyb21lUGtnKGJyb3dzZXJOYW1lKTtcbiAgY2Fwcy5hcHBQYWNrYWdlID0gcGtnO1xuICBjYXBzLmFwcEFjdGl2aXR5ID0gYWN0aXZpdHk7XG4gIGxvZ2dlci5pbmZvKGBhcHBQYWNrYWdlL2FwcEFjdGl2aXR5IGNhcGFiaWxpdGllcyBoYXZlIGJlZW4gYXV0b21hdGljYWxseSBzZXQgdG8gJHtwa2d9LyR7YWN0aXZpdHl9IGAgK1xuICAgIGBmb3IgJyR7YnJvd3Nlck5hbWV9J2ApO1xuICBsb2dnZXIuaW5mbyhgQ29uc2lkZXIgY2hhbmdpbmcgdGhlIGJyb3dzZXJOYW1lIHRvIHRoZSBvbmUgZnJvbSB0aGUgbGlzdCBvZiBzdXBwb3J0ZWQgYnJvd3NlciBuYW1lcyBgICtcbiAgICBgb3IgcHJvdmlkZSBjdXN0b20gYXBwUGFja2FnZS9hcHBBY3Rpdml0eSBjYXBhYmlsaXR5IHZhbHVlcyBpZiB0aGUgYXV0b21hdGljYWxseSBhc3NpZ25lZCBvbmVzIGRvIGAgK1xuICAgIGBub3QgbWFrZSBzZW5zZWApO1xuICByZXR1cm4gY2Fwcztcbn07XG5cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIGN1cnJlbnQgZGV2aWNlIHVuZGVyIHRlc3QgaXMgYW4gZW11bGF0b3JcbiAqXG4gKiBAcGFyYW0ge0FEQn0gYWRiIC0gYXBwaXVtLWFkYiBpbnN0YW5jZVxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgLSBkcml2ZXIgb3B0aW9ucyBtYXBwaW5nXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSBkZXZpY2UgaXMgYW4gQW5kcm9pZCBlbXVsYXRvclxuICovXG5oZWxwZXJzLmlzRW11bGF0b3IgPSBmdW5jdGlvbiBpc0VtdWxhdG9yIChhZGIsIG9wdHMpIHtcbiAgY29uc3QgcG9zc2libGVOYW1lcyA9IFtvcHRzLnVkaWQsIGFkYj8uY3VyRGV2aWNlSWRdO1xuICByZXR1cm4gISFvcHRzLmF2ZCB8fCBwb3NzaWJsZU5hbWVzLnNvbWUoKHgpID0+IEVNVUxBVE9SX1BBVFRFUk4udGVzdCh4KSk7XG59O1xuXG5oZWxwZXJzLmJvb3RzdHJhcCA9IEJvb3RzdHJhcDtcbmhlbHBlcnMudW5sb2NrZXIgPSB1bmxvY2tlcjtcblxuZXhwb3J0IHsgaGVscGVycywgU0VUVElOR1NfSEVMUEVSX1BLR19JRCwgcHJlcGFyZUF2ZEFyZ3MsIGVuc3VyZU5ldHdvcmtTcGVlZCB9O1xuZXhwb3J0IGRlZmF1bHQgaGVscGVycztcbiJdLCJmaWxlIjoibGliL2FuZHJvaWQtaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
