"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _appiumBaseDriver = require("appium-base-driver");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger"));

var _path = _interopRequireDefault(require("path"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _constants = require("../constants");

const EXECUTION_POLICY = {
  REMOTE_SIGNED: 'RemoteSigned',
  UNDEFINED: 'Undefined',
  RESTRICTED: 'Restricted'
};
const POWER_SHELL = 'powershell.exe';
const POWER_SHELL_SCRIPT_PATTERN = /^powerShell$/;
const commands = {};
exports.commands = commands;

commands.execute = async function execute(script, args) {
  if (POWER_SHELL_SCRIPT_PATTERN.test(script)) {
    this.ensureFeatureEnabled(_constants.POWER_SHELL_FEATURE);
    return await this.execPowerShell(script, _lodash.default.isArray(args) ? _lodash.default.first(args) : args);
  }

  throw new _appiumBaseDriver.errors.NotImplementedError();
};

commands.execPowerShell = async function execPowerShell(opts = {}) {
  const {
    script,
    command
  } = opts;

  if (!script && !command) {
    _logger.default.errorAndThrow('Power Shell script/command must not be empty');
  }

  if (/\n/.test(command)) {
    _logger.default.errorAndThrow('Power Shell commands cannot contain line breaks');
  }

  const shouldRunScript = !command && !!script;
  let tmpRoot;
  let userExecutionPolicy;

  try {
    let tmpScriptPath;

    if (shouldRunScript) {
      tmpRoot = await _appiumSupport.tempDir.openDir();
      tmpScriptPath = _path.default.resolve(tmpRoot, 'appium_script.ps1');
      await _appiumSupport.fs.writeFile(tmpScriptPath, script, 'utf8');
    }

    const psArgs = [];

    if (command) {
      psArgs.push('-command', command);
    } else {
      const {
        stdout
      } = await (0, _teen_process.exec)(POWER_SHELL, ['-command', 'Get-ExecutionPolicy -Scope CurrentUser']);
      userExecutionPolicy = _lodash.default.trim(stdout);

      if ([EXECUTION_POLICY.RESTRICTED, EXECUTION_POLICY.UNDEFINED].includes(userExecutionPolicy)) {
        _logger.default.debug(`Temporarily changing Power Shell execution policy to ${EXECUTION_POLICY.REMOTE_SIGNED} ` + 'to run the given script');

        await (0, _teen_process.exec)(POWER_SHELL, ['-command', `Set-ExecutionPolicy -Execution-Policy ${EXECUTION_POLICY.REMOTE_SIGNED} -Scope CurrentUser`]);
      } else {
        userExecutionPolicy = null;
      }

      psArgs.push('-file', tmpScriptPath);
    }

    _logger.default.info(`Running Power Shell with arguments: ${psArgs}`);

    try {
      const {
        stdout
      } = await (0, _teen_process.exec)(POWER_SHELL, psArgs);
      return stdout;
    } catch (e) {
      throw new Error(e.stderr || e.message);
    }
  } finally {
    await _bluebird.default.all([(async () => {
      if (userExecutionPolicy) {
        await (0, _teen_process.exec)(POWER_SHELL, ['-command', `Set-ExecutionPolicy -Execution-Policy ${userExecutionPolicy} -Scope CurrentUser`]);
      }
    })(), (async () => {
      if (tmpRoot) {
        await _appiumSupport.fs.rimraf(tmpRoot);
      }
    })()]);
  }
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9wb3dlcnNoZWxsLmpzIl0sIm5hbWVzIjpbIkVYRUNVVElPTl9QT0xJQ1kiLCJSRU1PVEVfU0lHTkVEIiwiVU5ERUZJTkVEIiwiUkVTVFJJQ1RFRCIsIlBPV0VSX1NIRUxMIiwiUE9XRVJfU0hFTExfU0NSSVBUX1BBVFRFUk4iLCJjb21tYW5kcyIsImV4ZWN1dGUiLCJzY3JpcHQiLCJhcmdzIiwidGVzdCIsImVuc3VyZUZlYXR1cmVFbmFibGVkIiwiUE9XRVJfU0hFTExfRkVBVFVSRSIsImV4ZWNQb3dlclNoZWxsIiwiXyIsImlzQXJyYXkiLCJmaXJzdCIsImVycm9ycyIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJvcHRzIiwiY29tbWFuZCIsImxvZyIsImVycm9yQW5kVGhyb3ciLCJzaG91bGRSdW5TY3JpcHQiLCJ0bXBSb290IiwidXNlckV4ZWN1dGlvblBvbGljeSIsInRtcFNjcmlwdFBhdGgiLCJ0ZW1wRGlyIiwib3BlbkRpciIsInBhdGgiLCJyZXNvbHZlIiwiZnMiLCJ3cml0ZUZpbGUiLCJwc0FyZ3MiLCJwdXNoIiwic3Rkb3V0IiwidHJpbSIsImluY2x1ZGVzIiwiZGVidWciLCJpbmZvIiwiZSIsIkVycm9yIiwic3RkZXJyIiwibWVzc2FnZSIsIkIiLCJhbGwiLCJyaW1yYWYiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsZ0JBQWdCLEdBQUc7QUFDdkJDLEVBQUFBLGFBQWEsRUFBRSxjQURRO0FBRXZCQyxFQUFBQSxTQUFTLEVBQUUsV0FGWTtBQUd2QkMsRUFBQUEsVUFBVSxFQUFFO0FBSFcsQ0FBekI7QUFLQSxNQUFNQyxXQUFXLEdBQUcsZ0JBQXBCO0FBQ0EsTUFBTUMsMEJBQTBCLEdBQUcsY0FBbkM7QUFFQSxNQUFNQyxRQUFRLEdBQUcsRUFBakI7OztBQUVBQSxRQUFRLENBQUNDLE9BQVQsR0FBbUIsZUFBZUEsT0FB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Q1IsVUFBTUMsa0JBQUVDLEdBQUYsQ0FBTSxDQUNWLENBQUMsWUFBWTtBQUNYLFVBQUlwQixtQkFBSixFQUF5QjtBQUN2QixjQUFNLHdCQUFLckIsV0FBTCxFQUFrQixDQUN0QixVQURzQixFQUNULHlDQUF3Q3FCLG1CQUFvQixxQkFEbkQsQ0FBbEIsQ0FBTjtBQUdEO0FBQ0YsS0FORCxHQURVLEVBUVYsQ0FBQyxZQUFZO0FBQ1gsVUFBSUQsT0FBSixFQUFhO0FBQ1gsY0FBTU8sa0JBQUdlLE1BQUgsQ0FBVXRCLE9BQVYsQ0FBTjtBQUNEO0FBQ0YsS0FKRCxHQVJVLENBQU4sQ0FBTjtBQWNEO0FBQ0YsQ0EvREQ7O2VBa0VlbEIsUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBmcywgdGVtcERpciB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgUE9XRVJfU0hFTExfRkVBVFVSRSB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5cbmNvbnN0IEVYRUNVVElPTl9QT0xJQ1kgPSB7XG4gIFJFTU9URV9TSUdORUQ6ICdSZW1vdGVTaWduZWQnLFxuICBVTkRFRklORUQ6ICdVbmRlZmluZWQnLFxuICBSRVNUUklDVEVEOiAnUmVzdHJpY3RlZCcsXG59O1xuY29uc3QgUE9XRVJfU0hFTEwgPSAncG93ZXJzaGVsbC5leGUnO1xuY29uc3QgUE9XRVJfU0hFTExfU0NSSVBUX1BBVFRFUk4gPSAvXnBvd2VyU2hlbGwkLztcblxuY29uc3QgY29tbWFuZHMgPSB7fTtcblxuY29tbWFuZHMuZXhlY3V0ZSA9IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGUgKHNjcmlwdCwgYXJncykge1xuICBpZiAoUE9XRVJfU0hFTExfU0NSSVBUX1BBVFRFUk4udGVzdChzY3JpcHQpKSB7XG4gICAgdGhpcy5lbnN1cmVGZWF0dXJlRW5hYmxlZChQT1dFUl9TSEVMTF9GRUFUVVJFKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjUG93ZXJTaGVsbChzY3JpcHQsIF8uaXNBcnJheShhcmdzKSA/IF8uZmlyc3QoYXJncykgOiBhcmdzKTtcbiAgfVxuICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRXhlY1Bvd2VyU2hlbGxPcHRpb25zXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHNjcmlwdCBBIHZhbGlkIFBvd2VyIFNoZWxsIHNjcmlwdCB0byBleGVjdXRlXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IGNvbW1hbmQgQSB2YWxpZCBQb3dlciBTaGVsbCBjb21tYW5kIHRvIGV4ZWN1dGVcbiAqL1xuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBnaXZlbiBQb3dlciBTaGVsbCBjb21tYW5kIG9yIGEgd2hvbGUgc2NyaXB0IGJhc2VkIG9uIHRoZVxuICogZ2l2ZW4gb3B0aW9ucy4gRWl0aGVyIG9mIHRoZXNlIG9wdGlvbnMgbXVzdCBiZSBwcm92aWRlZC4gSWYgYm90aCBhcmUgcHJvdmlkZWRcbiAqIHRoZW4gdGhlIGBjb21tYW5kYCBvbmUgZ2V0cyB0aGUgcHJpb3JpdHkuXG4gKiBOb3RlIHRoYXQgUG93ZXIgU2hlbGwgY29tbWFuZCBjYW5ub3QgY29udGFpbiBsaW5lIGJyZWFrcy4gQ29uc2lkZXIgbWFraW5nIGl0XG4gKiB0byBhIHNjcmlwdCBpbiBzdWNoIGNhc2UuXG4gKiBOb3RlIHRoYXQgYnkgZGVmYXVsdCBQb3dlciBTaGVsbCBibG9ja3Mgc2NyaXB0cyBleGVjdXRpb24sIHNvIHRoZSBzY3JpcHQgbXVzdFxuICogdGVtcG9yYXJpbHkgc3dpdGNoIHVzZXIgZXhlY3V0aW9uIHBvbGljeSBpZiBuZWNlc3NhcnkgYW5kIHJlc3RvcmUgaXQgYWZ0ZXJ3YXJkcy5cbiAqIFRoaXMgbWFrZXMgc2NyaXB0cyBzbGlnaHRseSBsZXNzIHBlcmZvcm1hbnQsIGFzIHNpbmdsZSBjb21tYW5kcy5cbiAqXG4gKiBAcGFyYW0geyFFeGVjUG93ZXJTaGVsbE9wdGlvbnN9IG9wdHNcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBhY3R1YWwgc3Rkb3V0IG9mIHRoZSBnaXZlbiBjb21tYW5kL3NjcmlwdFxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBleGl0IGNvZGUgb2YgdGhlIGdpdmVuIGNvbW1hbmQvc2NyaXB0IGlzIG5vdCB6ZXJvLlxuICogVGhlIGFjdHVhbCBzdGRlcnIgb3V0cHV0IGlzIHNldCB0byB0aGUgZXJyb3IgbWVzc2FnZSB2YWx1ZS5cbiAqL1xuY29tbWFuZHMuZXhlY1Bvd2VyU2hlbGwgPSBhc3luYyBmdW5jdGlvbiBleGVjUG93ZXJTaGVsbCAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBzY3JpcHQsXG4gICAgY29tbWFuZCxcbiAgfSA9IG9wdHM7XG4gIGlmICghc2NyaXB0ICYmICFjb21tYW5kKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ1Bvd2VyIFNoZWxsIHNjcmlwdC9jb21tYW5kIG11c3Qgbm90IGJlIGVtcHR5Jyk7XG4gIH1cbiAgaWYgKC9cXG4vLnRlc3QoY29tbWFuZCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnUG93ZXIgU2hlbGwgY29tbWFuZHMgY2Fubm90IGNvbnRhaW4gbGluZSBicmVha3MnKTtcbiAgfVxuICBjb25zdCBzaG91bGRSdW5TY3JpcHQgPSAhY29tbWFuZCAmJiAhIXNjcmlwdDtcblxuICBsZXQgdG1wUm9vdDtcbiAgbGV0IHVzZXJFeGVjdXRpb25Qb2xpY3k7XG4gIHRyeSB7XG4gICAgbGV0IHRtcFNjcmlwdFBhdGg7XG4gICAgaWYgKHNob3VsZFJ1blNjcmlwdCkge1xuICAgICAgdG1wUm9vdCA9IGF3YWl0IHRlbXBEaXIub3BlbkRpcigpO1xuICAgICAgdG1wU2NyaXB0UGF0aCA9IHBhdGgucmVzb2x2ZSh0bXBSb290LCAnYXBwaXVtX3NjcmlwdC5wczEnKTtcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZSh0bXBTY3JpcHRQYXRoLCBzY3JpcHQsICd1dGY4Jyk7XG4gICAgfVxuICAgIGNvbnN0IHBzQXJncyA9IFtdO1xuICAgIGlmIChjb21tYW5kKSB7XG4gICAgICBwc0FyZ3MucHVzaCgnLWNvbW1hbmQnLCBjb21tYW5kKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKFBPV0VSX1NIRUxMLCBbJy1jb21tYW5kJywgJ0dldC1FeGVjdXRpb25Qb2xpY3kgLVNjb3BlIEN1cnJlbnRVc2VyJ10pO1xuICAgICAgdXNlckV4ZWN1dGlvblBvbGljeSA9IF8udHJpbShzdGRvdXQpO1xuICAgICAgaWYgKFtFWEVDVVRJT05fUE9MSUNZLlJFU1RSSUNURUQsIEVYRUNVVElPTl9QT0xJQ1kuVU5ERUZJTkVEXS5pbmNsdWRlcyh1c2VyRXhlY3V0aW9uUG9saWN5KSkge1xuICAgICAgICBsb2cuZGVidWcoYFRlbXBvcmFyaWx5IGNoYW5naW5nIFBvd2VyIFNoZWxsIGV4ZWN1dGlvbiBwb2xpY3kgdG8gJHtFWEVDVVRJT05fUE9MSUNZLlJFTU9URV9TSUdORUR9IGAgK1xuICAgICAgICAgICd0byBydW4gdGhlIGdpdmVuIHNjcmlwdCcpO1xuICAgICAgICBhd2FpdCBleGVjKFBPV0VSX1NIRUxMLCBbXG4gICAgICAgICAgJy1jb21tYW5kJywgYFNldC1FeGVjdXRpb25Qb2xpY3kgLUV4ZWN1dGlvbi1Qb2xpY3kgJHtFWEVDVVRJT05fUE9MSUNZLlJFTU9URV9TSUdORUR9IC1TY29wZSBDdXJyZW50VXNlcmBcbiAgICAgICAgXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUaGVyZSBpcyBubyBuZWVkIHRvIGNoYW5nZSB0aGUgcG9saWN5LCBzY3JpcHRzIGFyZSBhbGxvd2VkXG4gICAgICAgIHVzZXJFeGVjdXRpb25Qb2xpY3kgPSBudWxsO1xuICAgICAgfVxuICAgICAgcHNBcmdzLnB1c2goJy1maWxlJywgdG1wU2NyaXB0UGF0aCk7XG4gICAgfVxuICAgIGxvZy5pbmZvKGBSdW5uaW5nIFBvd2VyIFNoZWxsIHdpdGggYXJndW1lbnRzOiAke3BzQXJnc31gKTtcbiAgICB0cnkge1xuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKFBPV0VSX1NIRUxMLCBwc0FyZ3MpO1xuICAgICAgcmV0dXJuIHN0ZG91dDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZS5zdGRlcnIgfHwgZS5tZXNzYWdlKTtcbiAgICB9XG4gIH0gZmluYWxseSB7XG4gICAgYXdhaXQgQi5hbGwoW1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKHVzZXJFeGVjdXRpb25Qb2xpY3kpIHtcbiAgICAgICAgICBhd2FpdCBleGVjKFBPV0VSX1NIRUxMLCBbXG4gICAgICAgICAgICAnLWNvbW1hbmQnLCBgU2V0LUV4ZWN1dGlvblBvbGljeSAtRXhlY3V0aW9uLVBvbGljeSAke3VzZXJFeGVjdXRpb25Qb2xpY3l9IC1TY29wZSBDdXJyZW50VXNlcmBcbiAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgfSkoKSxcbiAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICh0bXBSb290KSB7XG4gICAgICAgICAgYXdhaXQgZnMucmltcmFmKHRtcFJvb3QpO1xuICAgICAgICB9XG4gICAgICB9KSgpXG4gICAgXSk7XG4gIH1cbn07XG5cbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL3Bvd2Vyc2hlbGwuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
